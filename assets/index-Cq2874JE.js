(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))i(n);new MutationObserver(n=>{for(const r of n)if(r.type==="childList")for(const o of r.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function s(n){const r={};return n.integrity&&(r.integrity=n.integrity),n.referrerPolicy&&(r.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?r.credentials="include":n.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function i(n){if(n.ep)return;n.ep=!0;const r=s(n);fetch(n.href,r)}})();class v{constructor(e){this.canvas=e,this.ctx=e.getContext("2d"),this.running=!1,this.lastTime=0,this.intensity={scanline:.08,noise:.04,pulse:0,pulseFreq:0},this.resize(),window.addEventListener("resize",()=>this.resize())}resize(){this.canvas.width=window.innerWidth,this.canvas.height=window.innerHeight}updateFromGameState(e){const{noise:s=0,enemyDistance:i=5,isError:n=!1}=e;let r=.08,o=.04,c=0,h=0;s>=80?(r=.12,o=.08,c=.03,h=1.2):s>=50&&(r=.1,o=.06,c=.02,h=.8),i===0?(r=Math.max(r,.14),o=Math.max(o,.1),c=.05,h=2):i<=2?(r=Math.max(r,.12),o=Math.max(o,.08),c=Math.max(c,.04),h=Math.max(h,1.6)):i<=4&&(r=Math.max(r,.1),o=Math.max(o,.06),c=Math.max(c,.02),h=Math.max(h,1)),n&&(r+=.03,o+=.06),this.intensity={scanline:r,noise:o,pulse:c,pulseFreq:h}}start(){this.running=!0,this.lastTime=performance.now(),this.loop()}pause(){this.running=!1}resume(){this.running||(this.running=!0,this.lastTime=performance.now(),this.loop())}loop(){if(!this.running)return;const e=performance.now();(e-this.lastTime)/1e3,this.lastTime=e,this.render(e),requestAnimationFrame(()=>this.loop())}render(e){const{width:s,height:i}=this.canvas,n=this.ctx,{scanline:r,noise:o,pulse:c,pulseFreq:h}=this.intensity;n.clearRect(0,0,s,i);let l=1;c>0&&h>0&&(l=1+c*Math.sin(e*.001*Math.PI*2*h)),this.drawScanlines(n,s,i,r*l),this.drawNoise(n,s,i,o*l)}drawScanlines(e,s,i,n){if(n<=0)return;e.fillStyle=`rgba(0, 0, 0, ${n})`;const r=2;for(let o=0;o<i;o+=r*2)e.fillRect(0,o,s,r)}drawNoise(e,s,i,n){if(n<=0)return;const r=e.createImageData(s,i),o=r.data,c=Math.floor(n*255),h=.03,l=s*i,g=Math.floor(l*h);for(let f=0;f<g;f++){const u=Math.floor(Math.random()*l)*4,d=Math.random()>.5?255:0;o[u]=d,o[u+1]=d,o[u+2]=d,o[u+3]=c}e.putImageData(r,0,0)}glitch(e=200){const s={...this.intensity};this.intensity.scanline+=.05,this.intensity.noise+=.08,setTimeout(()=>{this.intensity=s},e)}}const a={WELCOME:"DEADLINE SHELL v0.1.0",BOOT_SEQUENCE:"ì‹œìŠ¤í…œ ë¶€íŒ… ì¤‘...",STORY_INTRO:["[ ë¹„ìƒ ì‹œìŠ¤í…œ ë¡œê·¸ ]","","ê²½ê³ : ìƒëª…ìœ ì§€ì¥ì¹˜ ì†ìƒ ê°ì§€","ê²½ê³ : ë¯¸í™•ì¸ ìƒëª…ì²´ íƒì§€","","ë‹¹ì‹ ì€ ìš°ì£¼ì •ê±°ì¥ì—ì„œ ê¹¨ì–´ë‚¬ìŠµë‹ˆë‹¤.","ì‚°ì†Œê°€ ìƒˆê³  ìˆê³ , ë¬´ì–¸ê°€ê°€ ë‹¹ì‹ ì„ ì¶”ì í•˜ê³  ìˆìŠµë‹ˆë‹¤.","íƒˆì¶œêµ¬ë¥¼ ì°¾ì•„ì•¼ í•©ë‹ˆë‹¤.","","---"],STORY_FIRST_TIP:"[ì‹œìŠ¤í…œ] í˜„ì¬ ìƒíƒœë¥¼ í™•ì¸í•˜ë ¤ë©´ status ë¥¼ ì…ë ¥í•˜ì„¸ìš”.",HELP_HEADER:"ì‚¬ìš© ê°€ëŠ¥í•œ ëª…ë ¹ì–´:",HELP_CMDS:{help:"ì´ ë„ì›€ë§ì„ í‘œì‹œí•©ë‹ˆë‹¤",status:"í˜„ì¬ ìƒíƒœë¥¼ í™•ì¸í•©ë‹ˆë‹¤",scan:"ì£¼ë³€ì„ ìŠ¤ìº”í•©ë‹ˆë‹¤ (ì†ŒìŒ +2)",ls:"í˜„ì¬ ë°©ì˜ ë¬¼ê±´ì„ í™•ì¸í•©ë‹ˆë‹¤",cd:"ë‹¤ë¥¸ ë°©ìœ¼ë¡œ ì´ë™í•©ë‹ˆë‹¤ (ì˜ˆ: cd reactor)",map:"ì •ê±°ì¥ ì§€ë„ë¥¼ í‘œì‹œí•©ë‹ˆë‹¤",objectives:"íƒˆì¶œ ëª©í‘œë¥¼ í™•ì¸í•©ë‹ˆë‹¤",hide:"ìˆ¨ìŠµë‹ˆë‹¤ (ì  ê±°ë¦¬ +2, ì†ŒìŒ ì´ˆê¸°í™”)",repair:"ëª©í‘œë¥¼ ìˆ˜ë¦¬í•©ë‹ˆë‹¤ (engineer ê¶Œí•œ í•„ìš”)",login:"ê¶Œí•œì„ íšë“í•©ë‹ˆë‹¤ (ì˜ˆ: login engineer)",su:"ê´€ë¦¬ì ê¶Œí•œìœ¼ë¡œ ì „í™˜í•©ë‹ˆë‹¤","lock door":"ë¬¸ì„ ì ê¸‰ë‹ˆë‹¤ (ì „ë ¥ -5)","unlock door":"ë¬¸ì„ ì—½ë‹ˆë‹¤",escape:"íƒˆì¶œí•©ë‹ˆë‹¤ (ì—ì–´ë½ì—ì„œ, ëª©í‘œ 2ê°œ ì´ìƒ ì™„ë£Œ ì‹œ)",shop:"ìƒì ì„ ì—´ì–´ í•´ê¸ˆ ì•„ì´í…œì„ êµ¬ë§¤í•©ë‹ˆë‹¤",stats:"ëˆ„ì  í†µê³„ë¥¼ í™•ì¸í•©ë‹ˆë‹¤"},STATUS_LOCATION:"ìœ„ì¹˜",STATUS_PERMISSION:"ê¶Œí•œ",STATUS_HEADER:"=== ì‹œìŠ¤í…œ ìƒíƒœ ===",PERMISSION:{guest:"ì†ë‹˜",engineer:"ì—”ì§€ë‹ˆì–´",admin:"ê´€ë¦¬ì"},ROOMS:{hub:"ì¤‘ì•™ í—ˆë¸Œ",reactor:"ì›ìë¡œì‹¤",medbay:"ì˜ë¬´ì‹¤",storage:"ì°½ê³ ",security:"ë³´ì•ˆì‹¤",airlock:"ì—ì–´ë½"},SCAN_START:"ìŠ¤ìº” ì¤‘...",SCAN_ENEMY_FAR:"ì  íƒì§€: ë©€ë¦¬ ìˆìŒ (ì•ˆì „)",SCAN_ENEMY_APPROACHING:"ì  íƒì§€: ì ‘ê·¼ ì¤‘...",SCAN_ENEMY_NEAR:"âš  ê²½ê³ : ì ì´ ê°€ê¹Œì´ ìˆìŒ!",SCAN_ENEMY_CRITICAL:"âš âš  ìœ„í—˜: ì ì´ ë§¤ìš° ê°€ê¹Œì›€!!",MOVE_SUCCESS:(t,e)=>`${e}(ìœ¼)ë¡œ ì´ë™í–ˆìŠµë‹ˆë‹¤`,MOVE_UNKNOWN:t=>`ì•Œ ìˆ˜ ì—†ëŠ” ì¥ì†Œ: ${t}`,MOVE_LOCKED:(t,e)=>`${e}ì€(ëŠ”) ì ê²¨ ìˆìŠµë‹ˆë‹¤`,MOVE_USAGE:"ì‚¬ìš©ë²•: cd <ì¥ì†Œ>",MOVE_NOT_CONNECTED:(t,e)=>`ì—¬ê¸°ì„œ ${e}(ìœ¼)ë¡œ ê°ˆ ìˆ˜ ì—†ìŠµë‹ˆë‹¤`,HIDE_SUCCESS:"ì¡°ìš©íˆ ìˆ¨ì—ˆìŠµë‹ˆë‹¤... ì ì´ ë©€ì–´ì§‘ë‹ˆë‹¤.",HIDE_FAIL:"ìˆ¨ì„ ê³³ì´ ì—†ìŠµë‹ˆë‹¤!",REPAIR_START:"ìˆ˜ë¦¬ë¥¼ ì‹œì‘í•©ë‹ˆë‹¤...",REPAIR_SUCCESS:t=>`${t} ìˆ˜ë¦¬ ì™„ë£Œ!`,REPAIR_FAIL:"ìˆ˜ë¦¬í•  ëŒ€ìƒì´ ì—†ìŠµë‹ˆë‹¤",REPAIR_USAGE:"ì‚¬ìš©ë²•: repair",REPAIR_NO_OBJECTIVE:"ì´ ë°©ì—ì„œ ìˆ˜ë¦¬í•  ëª©í‘œê°€ ì—†ìŠµë‹ˆë‹¤.",REPAIR_ALREADY_DONE:"ì´ë¯¸ ì™„ë£Œëœ ëª©í‘œì…ë‹ˆë‹¤.",REPAIR_WRONG_ROOM:t=>`ì´ ëª©í‘œëŠ” ${t}ì—ì„œë§Œ ìˆ˜í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.`,DOOR_LOCKED:"ë¬¸ì„ ì ê°”ìŠµë‹ˆë‹¤. (ì „ë ¥ -5)",DOOR_UNLOCKED:"ë¬¸ì„ ì—´ì—ˆìŠµë‹ˆë‹¤.",DOOR_ALREADY_LOCKED:"ì´ë¯¸ ì ê²¨ ìˆìŠµë‹ˆë‹¤.",DOOR_ALREADY_UNLOCKED:"ì´ë¯¸ ì—´ë ¤ ìˆìŠµë‹ˆë‹¤.",DOOR_NO_POWER:"ì „ë ¥ì´ ë¶€ì¡±í•©ë‹ˆë‹¤!",MAP_HEADER:"=== ì •ê±°ì¥ ì§€ë„ ===",MAP_CURRENT:t=>`í˜„ì¬ ìœ„ì¹˜: [${t}]`,MAP_CONNECTIONS:"ì—°ê²°ëœ êµ¬ì—­:",LS_HEADER:"=== í˜„ì¬ êµ¬ì—­ ===",LS_ITEMS:"ë°œê²¬ëœ ë¬¼ê±´:",LS_NOTHING:"íŠ¹ë³„í•œ ê²ƒì´ ì—†ìŠµë‹ˆë‹¤.",LOGIN_SUCCESS:t=>`ê¶Œí•œ íšë“: ${t}`,LOGIN_FAIL:"ë¡œê·¸ì¸ ì‹¤íŒ¨. ì˜¬ë°”ë¥¸ ê¶Œí•œì„ ì…ë ¥í•˜ì„¸ìš”.",LOGIN_USAGE:"ì‚¬ìš©ë²•: login <engineer>",LOGIN_ALREADY:t=>`ì´ë¯¸ ${t} ê¶Œí•œì…ë‹ˆë‹¤.`,LOGIN_NEED_SECURITY:"engineer ê¶Œí•œì€ ë³´ì•ˆì‹¤(security)ì—ì„œë§Œ íšë“í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.",SU_SUCCESS:"ê´€ë¦¬ì ê¶Œí•œì„ íšë“í–ˆìŠµë‹ˆë‹¤!",SU_FAIL:"su ì‹¤íŒ¨. íƒ€ì´í•‘ ì±Œë¦°ì§€ë¥¼ ì™„ë£Œí•˜ì„¸ìš”.",SU_NEED_ENGINEER:"suëŠ” engineer ê¶Œí•œì´ í•„ìš”í•©ë‹ˆë‹¤.",SU_NEED_SECURITY:"suëŠ” ë³´ì•ˆì‹¤(security)ì—ì„œë§Œ ê°€ëŠ¥í•©ë‹ˆë‹¤.",SU_ALREADY:"ì´ë¯¸ ê´€ë¦¬ì ê¶Œí•œì…ë‹ˆë‹¤.",CMD_NOT_FOUND:t=>`ëª…ë ¹ì–´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ: ${t}`,PERMISSION_DENIED:"ê¶Œí•œì´ ë¶€ì¡±í•©ë‹ˆë‹¤ (engineer ì´ìƒ í•„ìš”)",HINTS:{START:"[TIP] status ë¥¼ ì…ë ¥í•´ í˜„ì¬ ìƒíƒœë¥¼ í™•ì¸í•´ë³´ì„¸ìš”",AFTER_STATUS:"[TIP] scan ìœ¼ë¡œ ì£¼ë³€ ìœ„í˜‘ì„ ì‚´í´ë³´ì„¸ìš”",AFTER_SCAN:"[TIP] cd <ì¥ì†Œ> ë¡œ ë‹¤ë¥¸ ë°©ìœ¼ë¡œ ì´ë™í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤ (ì˜ˆ: cd reactor)",LOW_O2:"[TIP] ì‚°ì†Œê°€ ë¶€ì¡±í•©ë‹ˆë‹¤! ì„œë‘˜ëŸ¬ì•¼ í•©ë‹ˆë‹¤",ENEMY_NEAR:"[TIP] ì ì´ ê°€ê¹ìŠµë‹ˆë‹¤! hide ë¡œ ìˆ¨ê±°ë‚˜ ë¹ ë¥´ê²Œ ì´ë™í•˜ì„¸ìš”",STUCK:"[TIP] help ë¥¼ ì…ë ¥í•˜ë©´ ì‚¬ìš© ê°€ëŠ¥í•œ ëª…ë ¹ì–´ë¥¼ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤",NEED_ENGINEER:"[TIP] repair ë¥¼ í•˜ë ¤ë©´ engineer ê¶Œí•œì´ í•„ìš”í•©ë‹ˆë‹¤. security ì—ì„œ login engineer ë¥¼ ì‹œë„í•´ë³´ì„¸ìš”.",OBJECTIVE:"[TIP] objectives ë¥¼ ì…ë ¥í•˜ë©´ íƒˆì¶œ ëª©í‘œë¥¼ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤."},GAME_OVER:"========== ê²Œì„ ì˜¤ë²„ ==========",DEATH_O2:"ì‚°ì†Œ ë¶€ì¡±ìœ¼ë¡œ ì§ˆì‹í–ˆìŠµë‹ˆë‹¤.",DEATH_HP:"ì‚¬ë§í–ˆìŠµë‹ˆë‹¤.",DEATH_ENEMY:"ì¶”ì ìì—ê²Œ ë°œê°ë˜ì—ˆìŠµë‹ˆë‹¤.",RETRY:"ë‹¤ì‹œ ì‹œë„í•˜ë ¤ë©´ ìƒˆë¡œê³ ì¹¨í•˜ì„¸ìš”.",OBJECTIVE_HEADER:"=== íƒˆì¶œ ëª©í‘œ ===",OBJECTIVE_REACTOR:"[ ] ì›ìë¡œ ìˆ˜ë¦¬",OBJECTIVE_SECURITY:"[ ] ë³´ì•ˆ ì‹œìŠ¤í…œ í•´ì œ",OBJECTIVE_AIRLOCK:"[ ] ì—ì–´ë½ ì¤€ë¹„",OBJECTIVE_DONE:t=>`[âœ“] ${t}`,OBJECTIVE_HINT:"3ê°œ ì¤‘ 2ê°œë¥¼ ì™„ë£Œí•˜ë©´ íƒˆì¶œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.",OBJECTIVE_COMPLETE:t=>`â˜… ëª©í‘œ ì™„ë£Œ: ${t} â˜…`,ESCAPE_SUCCESS:"========== íƒˆì¶œ ì„±ê³µ! ==========",ESCAPE_VICTORY:"ë‹¹ì‹ ì€ ìš°ì£¼ì •ê±°ì¥ì„ íƒˆì¶œí–ˆìŠµë‹ˆë‹¤!",ESCAPE_FAIL_LOCATION:"íƒˆì¶œì€ ì—ì–´ë½(airlock)ì—ì„œë§Œ ê°€ëŠ¥í•©ë‹ˆë‹¤.",ESCAPE_FAIL_OBJECTIVES:(t,e)=>`íƒˆì¶œí•˜ë ¤ë©´ ëª©í‘œë¥¼ ${e}ê°œ ì´ìƒ ì™„ë£Œí•´ì•¼ í•©ë‹ˆë‹¤. (í˜„ì¬: ${t}ê°œ)`,TYPING_HEADER:"=== íƒ€ì´í•‘ ì±Œë¦°ì§€ ===",TYPING_INSTRUCTION:"ì•„ë˜ ëª…ë ¹ì–´ë¥¼ ì •í™•íˆ ì…ë ¥í•˜ì„¸ìš”:",TYPING_TIME_LIMIT:t=>`ì œí•œ ì‹œê°„: ${t}ì´ˆ`,TYPING_SUCCESS:t=>`âœ“ ì™„ë£Œ! (${t}ì´ˆ)`,TYPING_FAIL_TIMEOUT:"âœ— ì‹œê°„ ì´ˆê³¼!",TYPING_FAIL_WRONG:"ì˜¤íƒ€! ì†ŒìŒì´ ì¦ê°€í•©ë‹ˆë‹¤. ë‹¤ì‹œ ì…ë ¥í•˜ì„¸ìš”.",SHOP_HEADER:"=== ìƒì  ===",SHOP_DATA:t=>`ë³´ìœ  DATA: ${t}`,SHOP_BUY_USAGE:"êµ¬ë§¤: buy <ë²ˆí˜¸>",SHOP_BUY_SUCCESS:t=>`â˜… ${t} í•´ê¸ˆ! â˜…`,SHOP_BUY_FAIL_MONEY:(t,e)=>`DATAê°€ ë¶€ì¡±í•©ë‹ˆë‹¤. (í•„ìš”: ${t}, ë³´ìœ : ${e})`,SHOP_BUY_FAIL_OWNED:"ì´ë¯¸ í•´ê¸ˆëœ í•­ëª©ì…ë‹ˆë‹¤.",SHOP_BUY_FAIL_INVALID:"ì˜ëª»ëœ ë²ˆí˜¸ì…ë‹ˆë‹¤.",STATS_HEADER:"=== í†µê³„ ===",STATS_TOTAL_DATA:t=>`ì´ DATA: ${t}`,STATS_TOTAL_RUNS:t=>`ì´ ëŸ°: ${t}`,STATS_ESCAPES:t=>`íƒˆì¶œ ì„±ê³µ: ${t}`,STATS_DEATHS:t=>`ì‚¬ë§: ${t}`,STATS_FASTEST:(t,e)=>`ìµœë‹¨ íƒˆì¶œ: ${t}ë¶„ ${e}ì´ˆ`,RUN_REWARD_HEADER:"=== ëŸ° ê²°ê³¼ ===",RUN_REWARD_BREAKDOWN:"DATA íšë“ ë‚´ì—­:",RUN_REWARD_TOTAL:t=>`íšë“ DATA: +${t}`,RUN_REWARD_BANK:t=>`ì´ ë³´ìœ  DATA: ${t}`,RUN_REWARD_NEW_RECORD:"â˜… ìµœë‹¨ ì‹œê°„ ê°±ì‹ !",START_BONUS_HEADER:"=== ì‹œì‘ ë³´ë„ˆìŠ¤ ===",START_BONUS_APPLIED:t=>t.length>0?`ì ìš©ëœ í•´ê¸ˆ: ${t.join(", ")}`:"ì ìš©ëœ í•´ê¸ˆ ì—†ìŒ"},E="deadline-shell-tutorial";class k{constructor(e){this.game=e,this.steps=[{id:"status",command:"status",instruction:"í˜„ì¬ ìƒíƒœë¥¼ í™•ì¸í•˜ì„¸ìš”.",hint:"status ë¥¼ ì…ë ¥í•˜ì„¸ìš”."},{id:"scan",command:"scan",instruction:"ì£¼ë³€ì„ ìŠ¤ìº”í•˜ì—¬ ì ì˜ ìœ„ì¹˜ë¥¼ íŒŒì•…í•˜ì„¸ìš”.",hint:"scan ì„ ì…ë ¥í•˜ì„¸ìš”."},{id:"map",command:"map",instruction:"ì§€ë„ë¥¼ í™•ì¸í•˜ì—¬ ì •ê±°ì¥ êµ¬ì¡°ë¥¼ íŒŒì•…í•˜ì„¸ìš”.",hint:"map ì„ ì…ë ¥í•˜ì„¸ìš”."},{id:"move",command:"cd storage",instruction:"storage ë¡œ ì´ë™í•˜ì„¸ìš”.",hint:"cd storage ë¥¼ ì…ë ¥í•˜ì„¸ìš”.",validate:s=>s==="cd storage"},{id:"move2",command:"cd security",instruction:"security ë¡œ ì´ë™í•˜ì„¸ìš”.",hint:"cd security ë¥¼ ì…ë ¥í•˜ì„¸ìš”.",validate:s=>s==="cd security"},{id:"su",command:"su",instruction:"ê´€ë¦¬ì ê¶Œí•œì„ íšë“í•˜ì„¸ìš”.",hint:"su ë¥¼ ì…ë ¥í•˜ì„¸ìš”."},{id:"objectives",command:"objectives",instruction:"íƒˆì¶œ ëª©í‘œë¥¼ í™•ì¸í•˜ì„¸ìš”.",hint:"objectives ë¥¼ ì…ë ¥í•˜ì„¸ìš”."},{id:"hide",command:"hide",instruction:"hide ë¡œ ìˆ¨ì–´ë³´ì„¸ìš”.",hint:"hide ë¥¼ ì…ë ¥í•˜ì„¸ìš”."}],this.currentStep=0,this.completed=!1,this.enabled=!0,this.lastInputTime=Date.now(),this.hintInterval=null,this.load(),this.hintInterval=setInterval(()=>this.checkHint(),5e3)}load(){try{const e=localStorage.getItem(E);if(e){const s=JSON.parse(e);this.completed=s.completed||!1}}catch(e){console.warn("Tutorial load failed:",e)}}save(){try{localStorage.setItem(E,JSON.stringify({completed:this.completed}))}catch(e){console.warn("Tutorial save failed:",e)}}showIntro(){let e=0;a.STORY_INTRO.forEach(s=>{setTimeout(()=>{s===""?this.game.print(""):s.startsWith("ê²½ê³ ")?this.game.print(s,"warning"):s.startsWith("[")?this.game.print(s,"system"):this.game.print(s)},e),e+=s===""?100:300}),setTimeout(()=>{this.game.print(""),this.completed?(this.game.print("[ì‹œìŠ¤í…œ] íŠœí† ë¦¬ì–¼ ì™„ë£Œë¨. ììœ ë¡­ê²Œ í”Œë ˆì´í•˜ì„¸ìš”.","system"),this.game.print("[TIP] help ë¡œ ëª…ë ¹ì–´ ëª©ë¡ì„ í™•ì¸í•˜ì„¸ìš”.","system")):(this.game.print("â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—","warning"),this.game.print("â•‘         [íŠœí† ë¦¬ì–¼ ì‹œì‘]            â•‘","warning"),this.game.print("â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•","warning"),this.game.print(""),this.showCurrentStep())},e+800)}showCurrentStep(){if(this.completed||this.currentStep>=this.steps.length)return;const e=this.steps[this.currentStep];this.game.print(`[${this.currentStep+1}/${this.steps.length}] ${e.instruction}`,"warning"),this.game.print(`    â†’ ${e.hint}`,"system"),this.lastInputTime=Date.now()}beforeExecute(e){this.lastInputTime=Date.now()}onExecuted(e,s){if(this.completed||!s)return;const i=this.steps[this.currentStep];if(!i)return;(i.validate?i.validate(e):e===i.command)&&(this.currentStep++,this.currentStep>=this.steps.length?this.completeTutorial():setTimeout(()=>{this.game.print(""),this.showCurrentStep()},300))}completeTutorial(){this.completed=!0,this.save(),this.game.print(""),this.game.print("ğŸ‰ íŠœí† ë¦¬ì–¼ ì™„ë£Œ! ììœ ë¡­ê²Œ í”Œë ˆì´í•˜ì„¸ìš”.","success"),this.game.print("[TIP] objectives ë¡œ ëª©í‘œ í™•ì¸, airlock ì—ì„œ escape ë¡œ íƒˆì¶œ!","system"),this.game.achievements&&this.game.achievements.check("tutorial_complete")}markCompleted(){this.completed=!0,this.save()}isCompleted(){return this.completed}isInProgress(){return!this.completed&&this.currentStep<this.steps.length}checkHint(){if(!this.completed||!this.enabled||!this.game.state.running||this.game.state.paused||Date.now()-this.lastInputTime<15e3)return;const{resources:s,enemy:i}=this.game.state;s.o2<20?(this.game.print("[TIP] ì‚°ì†Œ ë¶€ì¡±! ì„œë‘ë¥´ì„¸ìš”.","system"),this.lastInputTime=Date.now()):i.distance<=2&&(this.game.print("[TIP] ì ì´ ê°€ê¹ìŠµë‹ˆë‹¤! hide ë˜ëŠ” ì´ë™í•˜ì„¸ìš”.","system"),this.lastInputTime=Date.now())}destroy(){this.hintInterval&&(clearInterval(this.hintInterval),this.hintInterval=null)}}class _{constructor(e){this.game=e,this.objectives={reactor:{id:"reactor",name:"ì›ìë¡œ ìˆ˜ë¦¬",nameEn:"Reactor Repair",completed:!1,room:"reactor",requiredPermission:"engineer"},security:{id:"security",name:"ë³´ì•ˆ ì‹œìŠ¤í…œ í•´ì œ",nameEn:"Security Override",completed:!1,room:"security",requiredPermission:"engineer"},airlock:{id:"airlock",name:"ì—ì–´ë½ ì¤€ë¹„",nameEn:"Airlock Preparation",completed:!1,room:"airlock",requiredPermission:"guest"}},this.requiredCount=2}complete(e){const s=this.objectives[e];return s?s.completed?(this.game.print(`ì´ë¯¸ ì™„ë£Œëœ ëª©í‘œì…ë‹ˆë‹¤: ${s.name}`,"warning"),!1):this.game.state.location!==s.room?(this.game.print(`${s.name}ì€(ëŠ”) ${a.ROOMS[s.room]}ì—ì„œë§Œ ê°€ëŠ¥í•©ë‹ˆë‹¤.`,"error"),!1):this.hasPermission(s.requiredPermission)?(s.completed=!0,!0):(this.game.print(a.PERMISSION_DENIED,"error"),!1):!1}hasPermission(e){const s={guest:0,engineer:1,admin:2},i=s[this.game.state.permission]||0,n=s[e]||0;return i>=n}getCompletedCount(){return Object.values(this.objectives).filter(e=>e.completed).length}canEscape(){return this.getCompletedCount()>=this.requiredCount&&this.game.state.location==="airlock"}showStatus(){this.game.print(a.OBJECTIVE_HEADER,"system"),this.game.print("");for(const e of Object.values(this.objectives))if(e.completed)this.game.print(`[âœ“] ${e.name}`,"success");else{const s=a.ROOMS[e.room];this.game.print(`[ ] ${e.name} (${s}ì—ì„œ ìˆ˜í–‰)`)}this.game.print(""),this.game.print(`ì§„í–‰: ${this.getCompletedCount()}/${this.requiredCount} ì™„ë£Œ`,"system"),this.game.print(a.OBJECTIVE_HINT,"system")}getObjectiveForRoom(e){return Object.values(this.objectives).find(s=>s.room===e&&!s.completed)}}class S{constructor(e){this.game=e,this.active=!1,this.currentPhrase="",this.onSuccess=null,this.onFail=null,this.timeLimit=1e4,this.timer=null,this.startTime=0,this.phrases={reactor:["systemctl restart reactor-core","sudo repair --target=coolant","init 3 && sync reactor"],security:["override --auth=bypass","chmod 777 /security/lock","sudo disable firewall"],airlock:["pressurize --chamber=main","seal-check --all","hatch open --confirm"],generic:["sudo systemctl restart","repair --force","diagnose -v --fix"]}}start(e,s,i){const n=this.phrases[e]||this.phrases.generic;return this.currentPhrase=n[Math.floor(Math.random()*n.length)],this.onSuccess=s,this.onFail=i,this.active=!0,this.startTime=Date.now(),this.game.print(""),this.game.print("=== íƒ€ì´í•‘ ì±Œë¦°ì§€ ===","warning"),this.game.print("ì•„ë˜ ëª…ë ¹ì–´ë¥¼ ì •í™•íˆ ì…ë ¥í•˜ì„¸ìš”:","system"),this.game.print(""),this.game.print(`  ${this.currentPhrase}`,"success"),this.game.print(""),this.game.print(`ì œí•œ ì‹œê°„: ${this.timeLimit/1e3}ì´ˆ`,"system"),this.game.print(""),this.timer=setTimeout(()=>{this.fail("ì‹œê°„ ì´ˆê³¼!")},this.timeLimit),!0}checkInput(e){return this.active?(e.trim()===this.currentPhrase?this.success():(this.game.state.resources.noise=Math.min(100,this.game.state.resources.noise+5),this.game.print("ì˜¤íƒ€! ì†ŒìŒì´ ì¦ê°€í•©ë‹ˆë‹¤. ë‹¤ì‹œ ì…ë ¥í•˜ì„¸ìš”.","error"),this.game.triggerError()),!0):!1}success(){this.cleanup();const e=((Date.now()-this.startTime)/1e3).toFixed(1);this.game.print(`âœ“ ì™„ë£Œ! (${e}ì´ˆ)`,"success"),this.game.print(""),this.onSuccess&&this.onSuccess()}fail(e){this.cleanup(),this.game.print(`âœ— ì‹¤íŒ¨: ${e}`,"error"),this.game.print(""),this.game.triggerError(),this.game.state.resources.noise=Math.min(100,this.game.state.resources.noise+10),this.onFail&&this.onFail()}cleanup(){this.active=!1,this.currentPhrase="",this.onSuccess=null,this.onFail=null,this.timer&&(clearTimeout(this.timer),this.timer=null)}isActive(){return this.active}getRemainingTime(){if(!this.active)return 0;const e=Date.now()-this.startTime;return Math.max(0,(this.timeLimit-e)/1e3)}}class y{constructor(e){this.game=e,this.eventCount=0,this.maxEvents=4,this.activeEvents=new Map,this.leakRoom=null,this.glitchActive=!1,this.glitchNextCommand=!1,this.eventTypes={blackout:{id:"blackout",name:"ì •ì „",nameEn:"BLACKOUT",icon:"âš¡",type:"error",probability:.06,duration:5,onTrigger:()=>this.triggerBlackout(),onTick:()=>this.tickBlackout(),onEnd:()=>this.endBlackout()},o2Leak:{id:"o2Leak",name:"ì‚°ì†Œ ëˆ„ì¶œ",nameEn:"O2 LEAK",icon:"ğŸ’¨",type:"error",probability:.05,duration:8,onTrigger:()=>this.triggerO2Leak(),onTick:()=>this.tickO2Leak(),onEnd:()=>this.endO2Leak()},noiseSpike:{id:"noiseSpike",name:"ì¶”ì  ê°•í™”",nameEn:"TRACKING",icon:"ğŸ“¡",type:"warning",probability:.04,duration:6,condition:()=>this.game.state.resources.noise>=40,onTrigger:()=>this.triggerNoiseSpike(),onTick:()=>this.tickNoiseSpike(),onEnd:()=>this.endNoiseSpike()},systemGlitch:{id:"systemGlitch",name:"ì‹œìŠ¤í…œ ë¶ˆì•ˆì •",nameEn:"UNSTABLE",icon:"ğŸ”§",type:"warning",probability:.04,duration:4,onTrigger:()=>this.triggerSystemGlitch(),onTick:()=>{},onEnd:()=>this.endSystemGlitch()},powerSurge:{id:"powerSurge",name:"ì „ë ¥ ê¸‰ì¦",nameEn:"SURGE",icon:"âš¡",type:"info",probability:.05,duration:1,onTrigger:()=>this.triggerPowerSurge(),onTick:()=>{},onEnd:()=>{}}}}isTutorialRun(){var e;return((e=this.game)==null?void 0:e.tutorial)&&!this.game.tutorial.isCompleted()}tick(){var e;for(const[s,i]of this.activeEvents)i.remaining--,i.onTick(),i.remaining<=0&&(i.onEnd(),this.activeEvents.delete(s),(e=this.game.leftPanel)==null||e.flash("success"));!this.isTutorialRun()&&this.eventCount<this.maxEvents&&this.game.state.time>=30&&this.checkNewEvent(),this.updateLeftPanel()}updateLeftPanel(){var s;const e=Array.from(this.activeEvents.values()).map(i=>({id:i.id,name:i.name,nameEn:i.nameEn,icon:i.icon,type:i.type,remaining:i.remaining,maxDuration:i.duration,detail:this.getEventDetail(i)}));(s=this.game.leftPanel)==null||s.updateEffects(e)}getEventDetail(e){switch(e.id){case"blackout":return"scan ë¹„í™œì„±í™”";case"o2Leak":return this.leakRoom?`${a.ROOMS[this.leakRoom]}`:"";case"noiseSpike":return"ì  ì´ë™ 2ë°°ì†";case"systemGlitch":return"ëª…ë ¹ ì‹¤íŒ¨ ê°€ëŠ¥";default:return""}}checkNewEvent(){for(const e of Object.values(this.eventTypes))if(!this.activeEvents.has(e.id)&&!(e.condition&&!e.condition())&&Math.random()<e.probability){this.triggerEvent(e);break}}triggerEvent(e){var s,i,n;this.eventCount++,this.activeEvents.set(e.id,{...e,remaining:e.duration}),(s=this.game.crt)==null||s.glitch(300),(i=this.game.leftPanel)==null||i.flash(e.type),(n=this.game.leftPanel)==null||n.logEvent(`${e.icon} ${e.name} ë°œìƒ!`,e.type),e.onTrigger()}triggerBlackout(){this.game.state.resources.power=Math.max(0,this.game.state.resources.power-15)}tickBlackout(){this.game.state.resources.power=Math.max(0,this.game.state.resources.power-1)}endBlackout(){var e;(e=this.game.leftPanel)==null||e.logEvent("âš¡ ì „ë ¥ ë³µêµ¬","success")}isBlackout(){return this.activeEvents.has("blackout")}triggerO2Leak(){this.leakRoom=this.game.state.location}tickO2Leak(){this.game.state.location===this.leakRoom&&(this.game.state.resources.o2=Math.max(0,this.game.state.resources.o2-2))}endO2Leak(){var e;(e=this.game.leftPanel)==null||e.logEvent("ğŸ’¨ ëˆ„ì¶œ ë´‰ì‡„","success"),this.leakRoom=null}getLeakRoom(){return this.activeEvents.has("o2Leak")?this.leakRoom:null}triggerNoiseSpike(){this.game.state.enemy.distance=Math.max(0,this.game.state.enemy.distance-1)}tickNoiseSpike(){this.game.state.time%2===0&&(this.game.state.enemy.distance=Math.max(0,this.game.state.enemy.distance-1))}endNoiseSpike(){var e;(e=this.game.leftPanel)==null||e.logEvent("ğŸ“¡ ì¶”ì  ì •ìƒí™”","success")}triggerSystemGlitch(){this.glitchActive=!0,this.glitchNextCommand=!0}endSystemGlitch(){var e;this.glitchActive=!1,this.glitchNextCommand=!1,(e=this.game.leftPanel)==null||e.logEvent("ğŸ”§ ì‹œìŠ¤í…œ ì•ˆì •í™”","success")}checkGlitchFail(){var e;return this.glitchActive&&this.glitchNextCommand&&(this.glitchNextCommand=!1,Math.random()<.3)?((e=this.game.leftPanel)==null||e.logEvent("ğŸ”§ ëª…ë ¹ ì‹¤íŒ¨!","error"),this.game.triggerError(),!0):!1}triggerPowerSurge(){var e,s;if(Math.random()<.5){const i=10+Math.floor(Math.random()*10);this.game.state.resources.power=Math.min(100,this.game.state.resources.power+i),(e=this.game.leftPanel)==null||e.logEvent(`âš¡ ì „ë ¥ +${i}`,"success")}else{const i=5+Math.floor(Math.random()*10);this.game.state.resources.power=Math.max(0,this.game.state.resources.power-i),this.game.state.resources.noise=Math.min(100,this.game.state.resources.noise+10),(s=this.game.leftPanel)==null||s.logEvent(`âš¡ ê³¼ë¶€í•˜ -${i}`,"error")}}getActiveEvents(){return Array.from(this.activeEvents.values()).map(e=>({name:e.name,remaining:e.remaining}))}showStatus(){}}const m="deadline-shell-meta";class O{constructor(e){this.game=e,this.unlockables={engineer_start:{id:"engineer_start",name:"Engineer ì‹œì‘",desc:"ëŸ° ì‹œì‘ ì‹œ engineer ê¶Œí•œìœ¼ë¡œ ì‹œì‘",cost:80,unlocked:!1},temp_su_token:{id:"temp_su_token",name:"ì„ì‹œ SU í† í°",desc:"ëŸ° ì‹œì‘ ì‹œ 1íšŒìš© su í† í° ë³´ìœ ",cost:40,unlocked:!1,consumable:!0},engineer_keycard:{id:"engineer_keycard",name:"Engineer í‚¤ì¹´ë“œ",desc:"ëŸ° ì‹œì‘ ì‹œ ì ê¸´ ë¬¸ 1ê°œ ì¦‰ì‹œ í•´ì œ ê°€ëŠ¥",cost:30,unlocked:!1,consumable:!0},emergency_o2:{id:"emergency_o2",name:"ì‘ê¸‰ O2 ìº”",desc:"ëŸ° ì‹œì‘ ì‹œ O2 +30 ì•„ì´í…œ ë³´ìœ ",cost:25,unlocked:!1,consumable:!0},early_drain_relief:{id:"early_drain_relief",name:"ì´ˆë°˜ ë“œë ˆì¸ ì™„í™”",desc:"ì²« 30ì´ˆê°„ O2 ë“œë ˆì¸ ì—†ìŒ",cost:50,unlocked:!1},shortcut_chance:{id:"shortcut_chance",name:"ë‹¨ì¶• ê²½ë¡œ í™•ë¥ ",desc:"hubâ†”airlock ì§í†µ ê²½ë¡œ í™•ë¥  +20%",cost:60,unlocked:!1}},this.runData={objectivesCompleted:0,logsCollected:0,dangerEscapes:0,escaped:!1},this.saved={totalData:0,unlocks:{},stats:{totalRuns:0,totalEscapes:0,totalDeaths:0,fastestEscape:null}},this.load()}load(){try{const e=localStorage.getItem(m);if(e){const s=JSON.parse(e);this.saved={...this.saved,...s};for(const i of Object.keys(this.saved.unlocks))this.unlockables[i]&&(this.unlockables[i].unlocked=!0)}}catch(e){console.warn("Meta load failed:",e)}}save(){try{localStorage.setItem(m,JSON.stringify(this.saved))}catch(e){console.warn("Meta save failed:",e)}}applyStartBonuses(){const e=[];return this.saved.unlocks.engineer_start&&(this.game.state.permission="engineer",e.push("Engineer ê¶Œí•œìœ¼ë¡œ ì‹œì‘")),this.saved.unlocks.early_drain_relief&&(this.game.state.earlyDrainRelief=!0,e.push("30ì´ˆê°„ O2 ë“œë ˆì¸ ì—†ìŒ")),this.saved.unlocks.emergency_o2&&(this.game.state.hasEmergencyO2=!0,e.push("ì‘ê¸‰ O2 ìº” ë³´ìœ ")),this.saved.unlocks.temp_su_token&&(this.game.state.hasTempSuToken=!0,e.push("ì„ì‹œ SU í† í° ë³´ìœ ")),this.saved.unlocks.engineer_keycard&&(this.game.state.hasEngineerKeycard=!0,e.push("Engineer í‚¤ì¹´ë“œ ë³´ìœ ")),e}onObjectiveComplete(){this.runData.objectivesCompleted++}onDangerEscape(){this.runData.dangerEscapes<3&&this.runData.dangerEscapes++}calculateRunReward(e,s){let i=0;const n=[],r=this.runData.objectivesCompleted*15;r>0&&(i+=r,n.push(`ëª©í‘œ ì™„ë£Œ (${this.runData.objectivesCompleted}ê°œ): +${r}`)),e?(i+=30,n.push("íƒˆì¶œ ì„±ê³µ: +30"),this.saved.stats.totalEscapes++,(!this.saved.stats.fastestEscape||s<this.saved.stats.fastestEscape)&&(this.saved.stats.fastestEscape=s,n.push("â˜… ìµœë‹¨ ì‹œê°„ ê°±ì‹ !"))):this.saved.stats.totalDeaths++;const o=this.runData.dangerEscapes*5;if(o>0&&(i+=o,n.push(`ìœ„í—˜ íƒˆì¶œ (${this.runData.dangerEscapes}íšŒ): +${o}`)),!e){const c=Math.floor(i*.5);i=i-c,c>0&&n.push(`ì‚¬ë§ íŒ¨ë„í‹° (-50%): -${c}`)}return this.saved.stats.totalRuns++,this.saved.totalData+=i,this.save(),{data:i,breakdown:n,total:this.saved.totalData}}showShop(){this.game.print(""),this.game.print("=== ìƒì  ===","system"),this.game.print(`ë³´ìœ  DATA: ${this.saved.totalData}`,"success"),this.game.print("");let e=1;for(const s of Object.values(this.unlockables)){const i=s.unlocked?"[í•´ê¸ˆë¨]":`[${s.cost} DATA]`,n=s.unlocked?"âœ“":`${e}.`;this.game.print(`${n} ${s.name} ${i}`),this.game.print(`   ${s.desc}`,"system"),e++}this.game.print(""),this.game.print("êµ¬ë§¤: buy <ë²ˆí˜¸>","system")}buyItem(e){const i=Object.values(this.unlockables)[e-1];return i?i.unlocked?(this.game.print("ì´ë¯¸ í•´ê¸ˆëœ í•­ëª©ì…ë‹ˆë‹¤.","warning"),!1):this.saved.totalData<i.cost?(this.game.print(`DATAê°€ ë¶€ì¡±í•©ë‹ˆë‹¤. (í•„ìš”: ${i.cost}, ë³´ìœ : ${this.saved.totalData})`,"error"),!1):(this.saved.totalData-=i.cost,this.saved.unlocks[i.id]=!0,i.unlocked=!0,this.save(),this.game.print(`â˜… ${i.name} í•´ê¸ˆ! â˜…`,"success"),this.game.print(`ë‚¨ì€ DATA: ${this.saved.totalData}`,"system"),!0):(this.game.print("ì˜ëª»ëœ ë²ˆí˜¸ì…ë‹ˆë‹¤.","error"),!1)}showStats(){const e=this.saved.stats;if(this.game.print(""),this.game.print("=== í†µê³„ ===","system"),this.game.print(`ì´ DATA: ${this.saved.totalData}`),this.game.print(`ì´ ëŸ°: ${e.totalRuns}`),this.game.print(`íƒˆì¶œ ì„±ê³µ: ${e.totalEscapes}`),this.game.print(`ì‚¬ë§: ${e.totalDeaths}`),e.fastestEscape){const s=Math.floor(e.fastestEscape/60),i=e.fastestEscape%60;this.game.print(`ìµœë‹¨ íƒˆì¶œ: ${s}ë¶„ ${i}ì´ˆ`)}this.game.print("")}resetRunData(){this.runData={objectivesCompleted:0,logsCollected:0,dangerEscapes:0,escaped:!1}}resetAll(){localStorage.removeItem(m),this.saved={totalData:0,unlocks:{},stats:{totalRuns:0,totalEscapes:0,totalDeaths:0,fastestEscape:null}};for(const e of Object.values(this.unlockables))e.unlocked=!1}}class T{constructor(e){this.game=e,this.baseConnections={hub:["reactor","medbay","storage"],reactor:["hub"],medbay:["hub"],storage:["hub","security"],security:["storage","airlock"],airlock:["security"]},this.connections={},this.lockedRooms=new Set,this.hasShortcut=!1,this.initializeMap()}initializeMap(){var r,o,c;this.connections={};for(const[h,l]of Object.entries(this.baseConnections))this.connections[h]=[...l];let e=.1;(c=(o=(r=this.game.meta)==null?void 0:r.saved)==null?void 0:o.unlocks)!=null&&c.shortcut_chance&&(e+=.2),Math.random()<e&&(this.hasShortcut=!0,this.connections.hub.push("airlock"),this.connections.airlock.push("hub")),this.lockedRooms.clear();const s=["reactor","medbay","storage","security"],i=Math.random()<.3?2:Math.random()<.5?1:0,n=[...s].sort(()=>Math.random()-.5);for(let h=0;h<i;h++)this.lockedRooms.add(n[h])}canMove(e,s){const i=this.connections[e];if(!i||!i.includes(s)){const n=a.ROOMS[s]||s;return{canMove:!1,reason:a.MOVE_NOT_CONNECTED(s,n)}}if(this.lockedRooms.has(s)){if(this.game.state.hasEngineerKeycard)return{canMove:!0,useKeycard:!0};const n=a.ROOMS[s]||s;return{canMove:!1,reason:a.MOVE_LOCKED(s,n),locked:!0}}return{canMove:!0}}unlockRoom(e){return this.lockedRooms.has(e)?this.game.state.permission==="guest"?(this.game.print(a.PERMISSION_DENIED,"error"),!1):(this.lockedRooms.delete(e),!0):!1}useKeycardOn(e){return!this.game.state.hasEngineerKeycard||!this.lockedRooms.has(e)?!1:(this.game.state.hasEngineerKeycard=!1,this.lockedRooms.delete(e),!0)}getAvailableRooms(e){return(this.connections[e]||[]).map(i=>({room:i,roomKr:a.ROOMS[i]||i,locked:this.lockedRooms.has(i)}))}showMap(){const e=this.game.state.location,s=a.ROOMS[e];this.game.print(a.MAP_HEADER,"system"),this.game.print("");const i=o=>this.lockedRooms.has(o)?"ğŸ”’":"",n=o=>o===e?"â˜…":"";this.hasShortcut?(this.game.print(`    [reactor]${i("reactor")}${n("reactor")}---[hub]${n("hub")}---[medbay]${i("medbay")}${n("medbay")}`),this.game.print("                  |     \\"),this.game.print(`              [storage]${i("storage")}${n("storage")}  \\`),this.game.print("                  |       \\"),this.game.print(`             [security]${i("security")}${n("security")}  |`),this.game.print("                  |       |"),this.game.print(`             [airlock]${n("airlock")}---+`)):(this.game.print(`    [reactor]${i("reactor")}${n("reactor")}---[hub]${n("hub")}---[medbay]${i("medbay")}${n("medbay")}`),this.game.print("                  |"),this.game.print(`              [storage]${i("storage")}${n("storage")}`),this.game.print("                  |"),this.game.print(`             [security]${i("security")}${n("security")}`),this.game.print("                  |"),this.game.print(`             [airlock]${n("airlock")}`)),this.game.print(""),this.game.print(`í˜„ì¬ ìœ„ì¹˜: â˜… ${s} (${e})`,"success");const r=this.getAvailableRooms(e);this.game.print(""),this.game.print("ì´ë™ ê°€ëŠ¥:","system"),r.forEach(({room:o,roomKr:c,locked:h})=>{const l=h?" ğŸ”’":"";this.game.print(`  cd ${o} - ${c}${l}`)}),this.lockedRooms.size>0&&(this.game.print(""),this.game.print("ğŸ”’ = ì ê¸´ êµ¬ì—­ (engineer ê¶Œí•œìœ¼ë¡œ unlock ë˜ëŠ” í‚¤ì¹´ë“œ í•„ìš”)","warning")),this.hasShortcut&&(this.game.print(""),this.game.print("âœ¨ ë‹¨ì¶• ê²½ë¡œ í™œì„±í™”: hub â†” airlock","success"))}canRun(e,s){const i=this.canMove(e,s);return i.canMove?{canMove:!0,extraNoise:3}:i}}const p="deadline-shell-achievements";class R{constructor(e){this.game=e,this.list={first_status:{id:"first_status",name:"ì‹œìŠ¤í…œ ì ê²€",desc:"ì²˜ìŒìœ¼ë¡œ status ëª…ë ¹ì–´ ì‚¬ìš©",reward:5,unlocked:!1,hidden:!1},first_scan:{id:"first_scan",name:"ë ˆì´ë” ê°€ë™",desc:"ì²˜ìŒìœ¼ë¡œ scan ëª…ë ¹ì–´ ì‚¬ìš©",reward:5,unlocked:!1,hidden:!1},first_move:{id:"first_move",name:"ì²« ë°œê±¸ìŒ",desc:"ì²˜ìŒìœ¼ë¡œ ë‹¤ë¥¸ ë°©ìœ¼ë¡œ ì´ë™",reward:5,unlocked:!1,hidden:!1},tutorial_complete:{id:"tutorial_complete",name:"í›ˆë ¨ ì™„ë£Œ",desc:"íŠœí† ë¦¬ì–¼ì„ ì™„ë£Œ",reward:20,unlocked:!1,hidden:!1},first_escape:{id:"first_escape",name:"ìƒì¡´ì",desc:"ì²˜ìŒìœ¼ë¡œ íƒˆì¶œ ì„±ê³µ",reward:50,unlocked:!1,hidden:!1},speed_escape:{id:"speed_escape",name:"ìŠ¤í”¼ë“œëŸ¬ë„ˆ",desc:"5ë¶„ ì´ë‚´ì— íƒˆì¶œ",reward:100,unlocked:!1,hidden:!1},perfect_escape:{id:"perfect_escape",name:"ì™„ë²½í•œ íƒˆì¶œ",desc:"ëª©í‘œ 3ê°œ ëª¨ë‘ ì™„ë£Œ í›„ íƒˆì¶œ",reward:80,unlocked:!1,hidden:!1},low_o2_escape:{id:"low_o2_escape",name:"ìˆ¨ ì°¸ê³  íƒˆì¶œ",desc:"O2 10% ì´í•˜ë¡œ íƒˆì¶œ",reward:60,unlocked:!1,hidden:!1},become_engineer:{id:"become_engineer",name:"ì—”ì§€ë‹ˆì–´",desc:"engineer ê¶Œí•œ íšë“",reward:10,unlocked:!1,hidden:!1},become_admin:{id:"become_admin",name:"ê´€ë¦¬ì",desc:"admin ê¶Œí•œ íšë“",reward:30,unlocked:!1,hidden:!1},danger_escape_1:{id:"danger_escape_1",name:"ì•„ìŠ¬ì•„ìŠ¬",desc:"ì  ê±°ë¦¬ 1ì—ì„œ ìƒì¡´",reward:15,unlocked:!1,hidden:!1},danger_escape_5:{id:"danger_escape_5",name:"ë°ìŠ¤ ëŒ„ì„œ",desc:"ì  ê±°ë¦¬ 1ì—ì„œ 5íšŒ ìƒì¡´ (ëˆ„ì )",reward:50,unlocked:!1,hidden:!0},hide_master:{id:"hide_master",name:"ì€ì‹ ì˜ ë‹¬ì¸",desc:"hide ëª…ë ¹ì–´ 10íšŒ ì‚¬ìš© (ëˆ„ì )",reward:30,unlocked:!1,hidden:!0},first_repair:{id:"first_repair",name:"ìˆ˜ë¦¬ê³µ",desc:"ì²˜ìŒìœ¼ë¡œ ëª©í‘œ ìˆ˜ë¦¬ ì™„ë£Œ",reward:15,unlocked:!1,hidden:!1},repair_all:{id:"repair_all",name:"ë§ŒëŠ¥ ì •ë¹„ì‚¬",desc:"í•œ ëŸ°ì—ì„œ ëª©í‘œ 3ê°œ ëª¨ë‘ ìˆ˜ë¦¬",reward:40,unlocked:!1,hidden:!1},survive_blackout:{id:"survive_blackout",name:"ì•”í‘ ì†ì—ì„œ",desc:"ì •ì „ ì´ë²¤íŠ¸ ë°œìƒ í›„ íƒˆì¶œ",reward:20,unlocked:!1,hidden:!0},survive_o2leak:{id:"survive_o2leak",name:"í˜¸í¡ ì¡°ì ˆ",desc:"ì‚°ì†Œ ëˆ„ì¶œ ì´ë²¤íŠ¸ ë°œìƒ í›„ íƒˆì¶œ",reward:20,unlocked:!1,hidden:!0},first_purchase:{id:"first_purchase",name:"ì‡¼í•‘ ì‹œì‘",desc:"ìƒì ì—ì„œ ì²« êµ¬ë§¤",reward:10,unlocked:!1,hidden:!1},data_collector:{id:"data_collector",name:"ë°ì´í„° ìˆ˜ì§‘ê°€",desc:"ì´ 500 DATA íšë“",reward:100,unlocked:!1,hidden:!1},runs_10:{id:"runs_10",name:"ì§‘ë…",desc:"10íšŒ í”Œë ˆì´",reward:30,unlocked:!1,hidden:!1},runs_50:{id:"runs_50",name:"ë² í…Œë‘",desc:"50íšŒ í”Œë ˆì´",reward:100,unlocked:!1,hidden:!0},first_death:{id:"first_death",name:"ì‹œì‘ì´ ë°˜",desc:"ì²˜ìŒìœ¼ë¡œ ì‚¬ë§",reward:5,unlocked:!1,hidden:!1},death_by_o2:{id:"death_by_o2",name:"ì§ˆì‹",desc:"ì‚°ì†Œ ë¶€ì¡±ìœ¼ë¡œ ì‚¬ë§",reward:5,unlocked:!1,hidden:!0},death_by_enemy:{id:"death_by_enemy",name:"ì¶”ì ë‹¹í•¨",desc:"ì ì—ê²Œ ë°œê°ë˜ì–´ ì‚¬ë§",reward:5,unlocked:!1,hidden:!0}},this.counters={dangerEscapes:0,hideUsed:0,totalRuns:0,totalData:0},this.runFlags={hadBlackout:!1,hadO2Leak:!1},this.load()}load(){try{const e=localStorage.getItem(p);if(e){const s=JSON.parse(e);if(s.unlocked)for(const i of s.unlocked)this.list[i]&&(this.list[i].unlocked=!0);s.counters&&(this.counters={...this.counters,...s.counters})}}catch(e){console.warn("Achievements load failed:",e)}}save(){try{const e=Object.values(this.list).filter(s=>s.unlocked).map(s=>s.id);localStorage.setItem(p,JSON.stringify({unlocked:e,counters:this.counters}))}catch(e){console.warn("Achievements save failed:",e)}}unlock(e){const s=this.list[e];return!s||s.unlocked?0:(s.unlocked=!0,this.save(),this.game.print(""),this.game.print("ğŸ† ì—…ì  ë‹¬ì„±!","success"),this.game.print(`   ${s.name}`,"success"),this.game.print(`   "${s.desc}"`,"system"),this.game.print(`   +${s.reward} DATA`,"warning"),this.game.print(""),this.game.meta&&(this.game.meta.saved.totalData+=s.reward,this.game.meta.save()),s.reward)}check(e,s={}){switch(e){case"command":this.checkCommand(s.cmd);break;case"escape":this.checkEscape(s);break;case"death":this.checkDeath(s);break;case"permission":this.checkPermission(s.level);break;case"repair":this.checkRepair(s);break;case"event":this.checkEvent(s.type);break;case"purchase":this.unlock("first_purchase");break;case"tutorial_complete":this.unlock("tutorial_complete");break;case"danger_escape":this.counters.dangerEscapes++,this.save(),this.unlock("danger_escape_1"),this.counters.dangerEscapes>=5&&this.unlock("danger_escape_5");break}}checkCommand(e){e==="status"&&this.unlock("first_status"),e==="scan"&&this.unlock("first_scan"),e.startsWith("cd ")&&this.unlock("first_move"),e==="hide"&&(this.counters.hideUsed++,this.save(),this.counters.hideUsed>=10&&this.unlock("hide_master"))}checkEscape(e){this.unlock("first_escape"),e.time<=300&&this.unlock("speed_escape"),e.objectives>=3&&this.unlock("perfect_escape"),e.o2<=10&&this.unlock("low_o2_escape"),this.runFlags.hadBlackout&&this.unlock("survive_blackout"),this.runFlags.hadO2Leak&&this.unlock("survive_o2leak")}checkDeath(e){this.unlock("first_death"),e.cause==="o2"?this.unlock("death_by_o2"):e.cause==="enemy"&&this.unlock("death_by_enemy")}checkPermission(e){e==="engineer"&&this.unlock("become_engineer"),e==="admin"&&this.unlock("become_admin")}checkRepair(e){this.unlock("first_repair"),e.total>=3&&this.unlock("repair_all")}checkEvent(e){e==="blackout"&&(this.runFlags.hadBlackout=!0),e==="o2leak"&&(this.runFlags.hadO2Leak=!0)}resetRunFlags(){this.runFlags={hadBlackout:!1,hadO2Leak:!1}}checkRuns(e){this.counters.totalRuns=e,this.save(),e>=10&&this.unlock("runs_10"),e>=50&&this.unlock("runs_50")}checkTotalData(e){this.counters.totalData=e,this.save(),e>=500&&this.unlock("data_collector")}showList(){this.game.print(""),this.game.print("=== ì—…ì  ===","system");const e=Object.values(this.list).filter(n=>n.unlocked),s=Object.values(this.list).filter(n=>!n.unlocked&&!n.hidden),i=Object.values(this.list).filter(n=>!n.unlocked&&n.hidden);this.game.print(`ë‹¬ì„±: ${e.length}/${Object.keys(this.list).length}`,"system"),this.game.print(""),e.length>0&&(this.game.print("[ë‹¬ì„±í•œ ì—…ì ]","success"),e.forEach(n=>{this.game.print(`  ğŸ† ${n.name} - ${n.desc}`)}),this.game.print("")),s.length>0&&(this.game.print("[ë¯¸ë‹¬ì„± ì—…ì ]","warning"),s.forEach(n=>{this.game.print(`  â—‹ ${n.name} - ${n.desc} (+${n.reward} DATA)`)}),this.game.print("")),i.length>0&&this.game.print(`[ìˆ¨ê²¨ì§„ ì—…ì : ${i.length}ê°œ]`,"system"),this.game.print("")}reset(){localStorage.removeItem(p);for(const e of Object.values(this.list))e.unlocked=!1;this.counters={dangerEscapes:0,hideUsed:0,totalRuns:0,totalData:0}}}class A{constructor(e,s){this.achievements=e,this.meta=s,this.sidebar=document.getElementById("achievements-sidebar"),this.progressEl=document.getElementById("achievement-progress"),this.recentListEl=document.getElementById("recent-achievements"),this.progressListEl=document.getElementById("progress-achievements"),this.toast=document.getElementById("achievement-toast"),this.toastNameEl=document.getElementById("toast-achievement-name"),this.toastRewardEl=document.getElementById("toast-achievement-reward"),this.statDataEl=document.getElementById("stat-data"),this.statRunsEl=document.getElementById("stat-runs"),this.statEscapesEl=document.getElementById("stat-escapes"),this.toastQueue=[],this.toastShowing=!1,this.recentUnlocked=[],this.render()}render(){this.renderProgress(),this.renderRecentAchievements(),this.renderProgressAchievements(),this.renderStats()}renderProgress(){const e=Object.values(this.achievements.list),s=e.filter(n=>n.unlocked).length,i=e.length;this.progressEl&&(this.progressEl.textContent=`${s}/${i}`)}renderRecentAchievements(){if(!this.recentListEl)return;const e=Object.values(this.achievements.list).filter(s=>s.unlocked).slice(-3).reverse();if(e.length===0){this.recentListEl.innerHTML='<div class="empty-message">ì•„ì§ ì—†ìŒ</div>';return}this.recentListEl.innerHTML=e.map(s=>`
      <div class="achievement-item unlocked">
        <div class="achievement-name">
          <span class="achievement-icon">ğŸ†</span>
          ${s.name}
        </div>
      </div>
    `).join("")}renderProgressAchievements(){if(!this.progressListEl)return;const e=Object.values(this.achievements.list).filter(s=>!s.unlocked&&!s.hidden).slice(0,4);if(e.length===0){this.progressListEl.innerHTML='<div class="empty-message">ëª¨ë‘ ë‹¬ì„±!</div>';return}this.progressListEl.innerHTML=e.map(s=>`
      <div class="achievement-item">
        <div class="achievement-name">
          <span class="achievement-icon">â—‹</span>
          ${s.name}
        </div>
        <div class="achievement-desc">${s.desc}</div>
        <div class="achievement-reward">+${s.reward} DATA</div>
      </div>
    `).join("")}renderStats(){if(!this.meta||!this.meta.saved)return;const e=this.meta.saved.stats||{};this.statDataEl&&(this.statDataEl.textContent=this.meta.saved.totalData||0),this.statRunsEl&&(this.statRunsEl.textContent=e.totalRuns||0),this.statEscapesEl&&(this.statEscapesEl.textContent=e.totalEscapes||0)}onUnlock(e){this.toastQueue.push(e),this.processToastQueue(),this.render()}processToastQueue(){if(this.toastShowing||this.toastQueue.length===0)return;const e=this.toastQueue.shift();this.showToast(e)}showToast(e){this.toast&&(this.toastShowing=!0,this.toastNameEl&&(this.toastNameEl.textContent=e.name),this.toastRewardEl&&(this.toastRewardEl.textContent=`+${e.reward} DATA`),this.toast.classList.remove("hidden","fade-out"),setTimeout(()=>{this.toast.classList.add("fade-out"),setTimeout(()=>{this.toast.classList.add("hidden"),this.toast.classList.remove("fade-out"),this.toastShowing=!1,this.processToastQueue()},500)},3e3))}updateStats(){this.renderStats()}}class I{constructor(){this.logEl=document.getElementById("system-log"),this.effectsEl=document.getElementById("active-effects"),this.maxLogs=6}logEvent(e,s="info"){if(!this.logEl)return;const i=document.createElement("div");for(i.className=`system-msg ${s}`,i.textContent=e,this.logEl.appendChild(i);this.logEl.children.length>this.maxLogs;)this.logEl.removeChild(this.logEl.firstChild);this.logEl.scrollTop=this.logEl.scrollHeight}updateEffects(e){if(this.effectsEl){if(!e||e.length===0){this.effectsEl.innerHTML=`
        <div class="effect-empty">
          <span class="effect-status-icon">âœ“</span>
          <span>ì‹œìŠ¤í…œ ì •ìƒ</span>
        </div>
      `;return}this.effectsEl.innerHTML=e.map(s=>{const i=s.maxDuration?Math.round(s.remaining/s.maxDuration*100):100;return`
        <div class="effect-card ${s.type||"warning"}">
          <div class="effect-header">
            <span class="effect-icon">${s.icon||"âš "}</span>
            <span class="effect-name">${s.nameEn||s.name}</span>
            <span class="effect-timer">${s.remaining}s</span>
          </div>
          <div class="effect-bar-bg">
            <div class="effect-bar" style="width: ${i}%"></div>
          </div>
          ${s.detail?`<div class="effect-detail">${s.detail}</div>`:""}
        </div>
      `}).join("")}}flash(e="warning"){this.effectsEl&&(this.effectsEl.classList.add(`flash-${e}`),setTimeout(()=>this.effectsEl.classList.remove(`flash-${e}`),300))}}function D(t){t.print(a.HELP_HEADER,"system"),t.print("");for(const[e,s]of Object.entries(a.HELP_CMDS))t.print(`  ${e.padEnd(12)} - ${s}`)}function b(t){const{resources:e,location:s,permission:i}=t.state,n=a.ROOMS[s]||s,r=a.PERMISSION[i]||i;t.print(a.STATUS_HEADER,"system"),t.print(`${a.STATUS_LOCATION}: ${n} (${s})`),t.print(`${a.STATUS_PERMISSION}: ${r} (${i})`),t.print(""),t.print(`HP: ${e.hp}  O2: ${e.o2}%`),t.print(`ì „ë ¥: ${e.power}  ì†ŒìŒ: ${e.noise}`),t.print(""),t.print(`ëª©í‘œ ì§„í–‰: ${t.objectives.getCompletedCount()}/2`,"system"),t.print(`ë³´ìœ  DATA: ${t.meta.saved.totalData}`,"system"),t.print("ì´ë²¤íŠ¸/ìƒíƒœëŠ” ì¢Œì¸¡ íŒ¨ë„ì—ì„œ í™•ì¸í•˜ì„¸ìš”.","system")}function $(t){if(t.events.isBlackout())return t.print("[ì˜¤ë¥˜] ì •ì „ìœ¼ë¡œ ìŠ¤ìº”ì´ ë¹„í™œì„±í™”ë˜ì—ˆìŠµë‹ˆë‹¤. (ì¢Œì¸¡ íŒ¨ë„ ì°¸ê³ )","error"),t.triggerError(),!1;t.state.resources.noise=Math.min(100,t.state.resources.noise+2),t.print(a.SCAN_START,"system");const e=t.state.enemy.distance;let s,i;e>=5?(s=a.SCAN_ENEMY_FAR,i="success"):e>=3?(s=a.SCAN_ENEMY_APPROACHING,i="warning"):e>=1?(s=a.SCAN_ENEMY_NEAR,i="error"):(s=a.SCAN_ENEMY_CRITICAL,i="error"),t.print(s,i),t.print(`(ê±°ë¦¬: ${e})`,"system");const n=t.events.getLeakRoom();return n&&t.leftPanel.logEvent(`ğŸ’¨ ì‚°ì†Œ ëˆ„ì¶œ ê°ì§€: ${a.ROOMS[n]}`,"warning"),!0}function C(t){const{location:e}=t.state,s=a.ROOMS[e]||e;t.print(a.LS_HEADER,"system"),t.print(`í˜„ì¬ ìœ„ì¹˜: ${s}`,"system"),t.print("");const n={hub:["í„°ë¯¸ë„","ë¹„ìƒ ì§€ë„"],reactor:["ì›ìë¡œ ì œì–´íŒ","ëƒ‰ê° ì‹œìŠ¤í…œ","ê³µêµ¬í•¨"],medbay:["ì˜ë£Œ í‚¤íŠ¸","ì‚°ì†Œ ìº”","ì§„ë‹¨ ì¥ë¹„"],storage:["ë¶€í’ˆ ìƒì","ë°°í„°ë¦¬","ì˜ˆë¹„ ë¶€í’ˆ"],security:["ë³´ì•ˆ ì½˜ì†”","í‚¤ì¹´ë“œ ë¦¬ë”ê¸°","ëª¨ë‹ˆí„°"],airlock:["íƒˆì¶œ í•´ì¹˜","ìš°ì£¼ë³µ","ë¹„ìƒ ë²„íŠ¼"]}[e]||[];n.length>0?(t.print(a.LS_ITEMS),n.forEach(o=>t.print(`  - ${o}`))):t.print(a.LS_NOTHING);const r=t.objectives.getObjectiveForRoom(e);r&&(t.print(""),t.print(`[ëª©í‘œ] ${r.name} - repair ëª…ë ¹ìœ¼ë¡œ ìˆ˜í–‰`,"warning"))}function N(t){t.objectives.showStatus()}function w(t){t.map.showMap()}function M(t,e){if(!e)return t.print(a.MOVE_USAGE,"error"),!1;const s=t.map.canMove(t.state.location,e);if(!s.canMove)return t.print(s.reason,"error"),s.locked&&t.leftPanel.logEvent(`ğŸ”’ ${a.ROOMS[e]} ì ê¹€: unlock ${e} í•„ìš”`,"warning"),t.triggerError(),!1;s.useKeycard&&(t.map.useKeycardOn(e),t.leftPanel.logEvent("Engineer í‚¤ì¹´ë“œë¡œ ì ê¸ˆ í•´ì œ!","success")),t.state.location=e,t.state.resources.noise=Math.min(100,t.state.resources.noise+1);const i=a.ROOMS[e]||e;t.print(a.MOVE_SUCCESS(e,i),"success");const n=t.objectives.getObjectiveForRoom(e);return n&&t.leftPanel.logEvent(`ëª©í‘œ ê°€ëŠ¥: ${n.name}`,"info"),t.events.getLeakRoom()===e&&t.leftPanel.logEvent("ğŸ’¨ ê²½ê³ : ì´ ë°©ì—ì„œ ì‚°ì†Œê°€ ëˆ„ì¶œë˜ê³  ìˆìŠµë‹ˆë‹¤!","error"),!0}function L(t,e){if(!e)return t.print("ì‚¬ìš©ë²•: run <ì¥ì†Œ>","error"),!1;const s=t.map.canMove(t.state.location,e);if(!s.canMove)return t.print(s.reason,"error"),t.triggerError(),!1;t.state.resources.noise=Math.min(100,t.state.resources.noise+3),t.state.location=e;const i=a.ROOMS[e]||e;return t.print(`${i}(ìœ¼)ë¡œ ë›°ì–´ê°‘ë‹ˆë‹¤! (ì†ŒìŒ +3)`,"success"),t.events.getLeakRoom()===e&&t.leftPanel.logEvent("ğŸ’¨ ê²½ê³ : ì´ ë°©ì—ì„œ ì‚°ì†Œê°€ ëˆ„ì¶œë˜ê³  ìˆìŠµë‹ˆë‹¤!","error"),!0}function P(t){t.state.resources.noise=0,t.state.enemy.distance=Math.min(5,t.state.enemy.distance+2),t.print(a.HIDE_SUCCESS,"success"),t.state.time+=2}function U(t){const{location:e,permission:s,resources:i}=t.state,n=t.objectives.getObjectiveForRoom(e);return n?n.completed?(t.print(a.REPAIR_ALREADY_DONE,"warning"),!1):n.requiresPermission&&s!=="admin"?(t.print(a.REPAIR_NEED_PERMISSION,"error"),t.triggerError(),!1):i.power<10?(t.print(a.REPAIR_NO_POWER,"error"),t.triggerError(),!1):(t.typingChallenge.start(n.id,()=>{i.power-=10,t.objectives.complete(n.id),t.leftPanel.logEvent(`âœ“ ìˆ˜ë¦¬ ì™„ë£Œ: ${n.name}`,"success"),t.achievements.check("repair"),t.objectives.canEscape()&&(t.print("","system"),t.print(a.ESCAPE_READY,"success"),t.leftPanel.logEvent("ğŸš€ íƒˆì¶œ ê°€ëŠ¥! airlockìœ¼ë¡œ ì´ë™ í›„ escape ì…ë ¥","success"))}),!0):(t.print(a.REPAIR_NOTHING,"warning"),!1)}function H(t,e){if(!e)return t.print("ì‚¬ìš©ë²•: login <ë ˆë²¨>","error"),t.print("ì˜ˆ: login user, login admin","system"),!1;if(!["guest","user","admin"].includes(e))return t.print(`ìœ íš¨í•˜ì§€ ì•Šì€ ê¶Œí•œ ë ˆë²¨: ${e}`,"error"),t.triggerError(),!1;if(e==="admin")return t.print(a.LOGIN_ADMIN_DENIED,"error"),t.print("íŒíŠ¸: su ëª…ë ¹ìœ¼ë¡œ ê´€ë¦¬ì ê¶Œí•œ íšë“ ê°€ëŠ¥","system"),t.triggerError(),!1;t.state.permission=e;const i=a.PERMISSION[e]||e;return t.print(`ê¶Œí•œ ë³€ê²½: ${i}`,"success"),!0}function j(t){const{location:e,permission:s}=t.state;return s==="admin"?(t.print(a.SU_ALREADY_ADMIN,"warning"),!1):t.state.hasTempSuToken?(t.state.hasTempSuToken=!1,t.state.permission="admin",t.leftPanel.logEvent("ğŸ”‘ ì„ì‹œ SU í† í° ì‚¬ìš©!","success"),t.print(a.SU_SUCCESS,"success"),t.achievements.check("su"),!0):e!=="security"?(t.print(a.SU_WRONG_LOCATION,"error"),t.triggerError(),!1):(t.typingChallenge.start("su",()=>{t.state.permission="admin",t.print(a.SU_SUCCESS,"success"),t.leftPanel.logEvent("ğŸ”“ ê´€ë¦¬ì ê¶Œí•œ íšë“!","success"),t.achievements.check("su")}),!0)}function x(t){const{resources:e,doorLocked:s}=t.state;if(s){t.print(a.DOOR_ALREADY_LOCKED,"warning");return}if(e.power<5){t.print(a.DOOR_NO_POWER,"error");return}e.power-=5,t.state.doorLocked=!0,t.leftPanel.logEvent("ğŸšª ë¬¸ ì ê¸ˆ (ì „ë ¥ -5)","info"),t.print(a.DOOR_LOCKED,"success")}function B(t){if(!t.state.doorLocked){t.print(a.DOOR_ALREADY_UNLOCKED,"warning");return}t.state.doorLocked=!1,t.leftPanel.logEvent("ğŸšª ë¬¸ ì ê¸ˆ í•´ì œ","info"),t.print(a.DOOR_UNLOCKED,"success")}function G(t,e){if(!t.map.lockedRooms.has(e))return t.print(`${e}ì€(ëŠ”) ì ê²¨ìˆì§€ ì•ŠìŠµë‹ˆë‹¤.`,"warning"),!1;if(t.map.unlockRoom(e)){const s=a.ROOMS[e]||e;return t.leftPanel.logEvent(`ğŸ”“ ì ê¸ˆ í•´ì œ: ${s}`,"success"),t.print(`${s} ì ê¸ˆ í•´ì œ!`,"success"),!0}return!1}function F(t){const{location:e,permission:s}=t.state;return e!=="airlock"?(t.print(a.ESCAPE_WRONG_LOCATION,"error"),t.triggerError(),!1):t.objectives.canEscape()?s!=="admin"?(t.print(a.ESCAPE_NEED_ADMIN,"error"),t.triggerError(),!1):(t.victory(),!0):(t.print(a.ESCAPE_NOT_READY,"error"),t.print(`ëª©í‘œ ì§„í–‰: ${t.objectives.getCompletedCount()}/2`,"system"),t.triggerError(),!1)}function Y(t){t.print(a.SHOP_HEADER,"system"),t.print(`ë³´ìœ  DATA: ${t.meta.saved.totalData}`,"system"),t.print(""),t.meta.getShopItems().forEach((s,i)=>{const n=s.owned?"[ë³´ìœ ì¤‘]":`${s.cost} DATA`;t.print(`  ${i+1}. ${s.name} - ${n}`),t.print(`     ${s.desc}`,"system")}),t.print(""),t.print("êµ¬ë§¤: buy <ë²ˆí˜¸>","system")}function K(t,e){if(isNaN(e)||e<1)return t.print("ì‚¬ìš©ë²•: buy <ë²ˆí˜¸>","error"),!1;const s=t.meta.buyItem(e-1);return s.success?(t.print(s.message,"success"),t.leftPanel.logEvent(`ğŸ›’ êµ¬ë§¤: ${s.itemName}`,"success"),t.achievementsUI.updateStats(),!0):(t.print(s.message,"error"),!1)}function V(t,e){if(!e)return t.print("ì‚¬ìš©ë²•: use <ì•„ì´í…œ>","error"),t.print("ì‚¬ìš© ê°€ëŠ¥: o2 (ë¹„ìƒ ì‚°ì†Œ)","system"),!1;switch(e){case"o2":return t.state.hasEmergencyO2?(t.state.hasEmergencyO2=!1,t.state.resources.o2=Math.min(100,t.state.resources.o2+30),t.print("ë¹„ìƒ ì‚°ì†Œ ì‚¬ìš©! O2 +30%","success"),t.leftPanel.logEvent("ğŸ’¨ ë¹„ìƒ ì‚°ì†Œ ì‚¬ìš© (+30%)","success"),!0):(t.print("ë¹„ìƒ ì‚°ì†Œê°€ ì—†ìŠµë‹ˆë‹¤.","error"),!1);default:return t.print(`ì•Œ ìˆ˜ ì—†ëŠ” ì•„ì´í…œ: ${e}`,"error"),!1}}function W(t){const e=t.meta.saved.stats;t.print(a.STATS_HEADER,"system"),t.print(""),t.print(`ì´ í”Œë ˆì´ íšŸìˆ˜: ${e.totalRuns}`),t.print(`íƒˆì¶œ ì„±ê³µ: ${e.escapes}`),t.print(`ì´ íšë“ DATA: ${e.totalDataEarned}`),t.print(`í˜„ì¬ DATA: ${t.meta.saved.totalData}`),t.print(""),t.print(`ìµœë‹¨ íƒˆì¶œ ì‹œê°„: ${e.fastestEscape>0?e.fastestEscape+"ì´ˆ":"-"}`),t.print(`ìœ„ê¸° íƒˆì¶œ íšŸìˆ˜: ${e.dangerEscapes}`)}class J{constructor({outputEl:e,inputEl:s,promptEl:i,hudEl:n,terminalEl:r,crt:o}){this.outputEl=e,this.inputEl=s,this.promptEl=i,this.hudEl=n,this.terminalEl=r,this.crt=o,this.state={running:!1,paused:!1,permission:"guest",location:"hub",resources:{hp:100,o2:100,power:50,noise:0},time:0,enemy:{distance:5},doorLocked:!1,earlyDrainRelief:!1,hasEmergencyO2:!1,hasTempSuToken:!1,hasEngineerKeycard:!1},this.tickInterval=null,this.history=[],this.historyIndex=-1,this.leftPanel=new I,this.tutorial=new k(this),this.objectives=new _(this),this.typingChallenge=new S(this),this.events=new y(this),this.meta=new O(this),this.map=new T(this),this.achievements=new R(this),this.achievementsUI=new A(this.achievements,this.meta),this.inputEl.addEventListener("keydown",c=>this.handleInput(c))}start(){this.state.running=!0,this.state.paused=!1,this.achievements.resetRunFlags();const e=this.meta.applyStartBonuses();if(this.tutorial.showIntro(),this.leftPanel.logEvent("ì‹œìŠ¤í…œ ëª¨ë‹ˆí„°ë§ ì‹œì‘","info"),this.tutorial.isCompleted()){if(this.map.lockedRooms.size>0){const s=Array.from(this.map.lockedRooms).map(i=>a.ROOMS[i]).join(", ");this.leftPanel.logEvent(`ğŸ”’ ì ê¸´ êµ¬ì—­: ${s}`,"warning")}e.length>0&&e.forEach(s=>this.leftPanel.logEvent(`âœ“ ì‹œì‘ ë³´ë„ˆìŠ¤: ${s}`,"success"))}else this.leftPanel.logEvent("íŠœí† ë¦¬ì–¼ ëŸ°: ì´ë²¤íŠ¸/ì ê¸ˆ ë¹„í™œì„±í™”","info");setTimeout(()=>{this.tickInterval=setInterval(()=>this.tick(),1e3)},1200),this.updateHUD(),this.inputEl.focus(),this.achievements.checkRuns(this.meta.saved.stats.totalRuns),this.achievements.checkTotalData(this.meta.saved.totalData)}pause(){this.state.paused=!0,this.tickInterval&&(clearInterval(this.tickInterval),this.tickInterval=null)}resume(){this.state.running&&this.state.paused&&(this.state.paused=!1,this.tickInterval=setInterval(()=>this.tick(),1e3))}tick(){if(this.state.paused)return;const{resources:e,enemy:s}=this.state;this.state.earlyDrainRelief&&this.state.time<30||(e.o2=Math.max(0,e.o2-1)),e.noise=Math.max(0,e.noise-1),this.state.time++,this.state.time%3===0&&e.noise>30&&(s.distance=Math.max(0,s.distance-1)),s.distance===1&&(this.meta.onDangerEscape(),this.achievements.check("danger_escape")),this.events.tick(),this.tutorial.checkHint(),this.updateHUD(),this.updateCRT(),this.achievementsUI.updateStats(),(e.o2<=0||e.hp<=0||s.distance===0)&&this.gameOver()}handleInput(e){if(e.key==="Enter"){const s=this.inputEl.value.trim();s&&(this.history.push(s),this.historyIndex=this.history.length,this.typingChallenge.isActive()?(this.print(`> ${s}`),this.typingChallenge.checkInput(s)):this.executeCommand(s)),this.inputEl.value=""}else e.key==="ArrowUp"?(e.preventDefault(),this.historyIndex>0&&(this.historyIndex--,this.inputEl.value=this.history[this.historyIndex])):e.key==="ArrowDown"?(e.preventDefault(),this.historyIndex<this.history.length-1?(this.historyIndex++,this.inputEl.value=this.history[this.historyIndex]):(this.historyIndex=this.history.length,this.inputEl.value="")):e.key==="Tab"&&(e.preventDefault(),this.autoComplete())}autoComplete(){const e=this.inputEl.value.toLowerCase(),i=["help","status","scan","cd","run","ls","map","objectives","hide","repair","login","su","lock","unlock","escape","shop","stats","buy","use","achievements"].find(n=>n.startsWith(e));i&&(this.inputEl.value=i)}executeCommand(e){const s=e.trim().toLowerCase();if(this.tutorial.beforeExecute(s),this.print(`> ${e}`),this.events.checkGlitchFail()){this.tutorial.onExecuted(s,!1);return}const i=s.split(" "),n=i[0],r=i.slice(1);["shop","stats","buy","achievements"].includes(n)||(this.state.resources.noise=Math.min(100,this.state.resources.noise+2)),this.achievements.check("command",{cmd:s});let c=!0;switch(n){case"help":D(this);break;case"status":b(this);break;case"scan":c=$(this);break;case"cd":c=M(this,r[0]);break;case"run":c=L(this,r[0]);break;case"ls":C(this);break;case"map":w(this);break;case"objectives":N(this);break;case"hide":P(this);break;case"repair":c=U(this);break;case"login":c=H(this,r[0]);break;case"su":c=j(this);break;case"escape":c=F(this);break;case"lock":r[0]==="door"?x(this):(this.print(a.CMD_NOT_FOUND(n),"error"),c=!1);break;case"unlock":r[0]==="door"?B(this):r[0]?c=G(this,r[0]):(this.print(a.CMD_NOT_FOUND(n),"error"),c=!1);break;case"shop":Y(this);break;case"stats":W(this);break;case"buy":c=K(this,parseInt(r[0]));break;case"use":c=V(this,r[0]);break;case"achievements":this.achievements.showList();break;default:this.print(a.CMD_NOT_FOUND(n),"error"),this.triggerError(),c=!1}this.tutorial.onExecuted(s,c),this.updateHUD(),this.updateCRT()}print(e,s="default"){const i=document.createElement("div");i.className=`output-line ${s}`,i.textContent=e,this.outputEl.appendChild(i),this.outputEl.scrollTop=this.outputEl.scrollHeight}printHTML(e){const s=document.createElement("div");s.className="output-line",s.innerHTML=e,this.outputEl.appendChild(s),this.outputEl.scrollTop=this.outputEl.scrollHeight}clearOutput(){this.outputEl.innerHTML=""}updateHUD(){const{resources:e,permission:s,location:i,time:n,enemy:r}=this.state,o=a.ROOMS[i]||i,c=a.PERMISSION[s]||s;this.hudEl.innerHTML=`
      <span class="hud-item">HP: ${e.hp}</span>
      <span class="hud-item ${e.o2<30?"danger":""}">O2: ${e.o2}%</span>
      <span class="hud-item">âš¡${e.power}</span>
      <span class="hud-item ${e.noise>50?"warning":""}">ğŸ”Š${e.noise}</span>
      <span class="hud-item">ğŸ“${o}</span>
      <span class="hud-item">ğŸ”‘${c}</span>
      <span class="hud-item">â±${n}s</span>
      <span class="hud-item ${r.distance<=2?"danger":""}">ğŸ‘¾${r.distance}</span>
    `,this.promptEl.textContent=`${i}@${s}:~$ `}updateCRT(){if(!this.crt)return;const{resources:e,enemy:s}=this.state;e.o2<30,s.distance<=2,e.hp<50,this.crt.updateFromGameState({noise:this.state.resources.noise,enemyDistance:this.state.enemy.distance})}triggerError(){var e;this.crt&&this.crt.glitch(200),(e=this.terminalEl)==null||e.classList.add("shake"),setTimeout(()=>{var s;(s=this.terminalEl)==null||s.classList.remove("shake")},200)}gameOver(){this.state.running=!1,this.tickInterval&&(clearInterval(this.tickInterval),this.tickInterval=null);const{resources:e,enemy:s,time:i}=this.state;let n="ì•Œ ìˆ˜ ì—†ëŠ” ì›ì¸";e.o2<=0?n="ì‚°ì†Œ ê³ ê°ˆ":e.hp<=0?n="ì²´ë ¥ ì†Œì§„":s.distance===0&&(n="ì ì—ê²Œ ë°œê°"),this.print(""),this.print("========================================","error"),this.print("  G A M E   O V E R","error"),this.print(`  ì‚¬ë§ ì›ì¸: ${n}`,"error"),this.print(`  ìƒì¡´ ì‹œê°„: ${i}ì´ˆ`,"error"),this.print("========================================","error"),this.print(""),this.meta.onGameOver();const r=Math.floor(i/10)+this.objectives.getCompletedCount()*5;this.meta.addData(r),this.print(`íšë“ DATA: ${r}`,"system"),this.print(""),this.print("í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•˜ì—¬ ì¬ì‹œì‘í•˜ì„¸ìš”.","system"),this.achievementsUI.updateStats()}victory(){this.state.running=!1,this.tickInterval&&(clearInterval(this.tickInterval),this.tickInterval=null);const{time:e}=this.state;this.print(""),this.print("========================================","success"),this.print("  ğŸ‰ íƒˆì¶œ ì„±ê³µ! ğŸ‰","success"),this.print(`  í´ë¦¬ì–´ ì‹œê°„: ${e}ì´ˆ`,"success"),this.print("========================================","success"),this.print(""),this.meta.onVictory(e);const s=Math.max(0,100-e),i=50+s;this.meta.addData(i),this.print(`íšë“ DATA: ${i} (ê¸°ë³¸ 50 + ì‹œê°„ ë³´ë„ˆìŠ¤ ${s})`,"system"),this.achievements.check("escape"),this.achievements.check("speed",{time:e}),this.achievements.check("no_damage"),this.tutorial.isCompleted()||(this.tutorial.markCompleted(),this.print(""),this.print("ğŸ“ íŠœí† ë¦¬ì–¼ ì™„ë£Œ! ë‹¤ìŒ ëŸ°ë¶€í„° ëœë¤ ìš”ì†Œê°€ í™œì„±í™”ë©ë‹ˆë‹¤.","success")),this.print(""),this.print("í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•˜ì—¬ ì¬ì‹œì‘í•˜ì„¸ìš”.","system"),this.achievementsUI.updateStats()}}document.addEventListener("DOMContentLoaded",()=>{const t=document.getElementById("crt-overlay"),e=new v(t);e.start();const s=new J({outputEl:document.getElementById("output"),inputEl:document.getElementById("command-input"),promptEl:document.querySelector(".prompt"),hudEl:document.getElementById("hud"),terminalEl:document.getElementById("terminal"),crt:e});s.start(),document.addEventListener("visibilitychange",()=>{document.hidden?(s.pause(),e.pause()):(s.resume(),e.resume())}),document.addEventListener("click",()=>{document.getElementById("command-input").focus()})});
