/**\n * Achievements - ÏóÖÏ†Å ÏãúÏä§ÌÖú\n * localStorageÏóê Ï†ÄÏû•, DATA Î≥¥ÏÉÅ\n */\n\nconst STORAGE_KEY = 'deadline-shell-achievements';\n\nexport class Achievements {\n  constructor(game) {\n    this.game = game;\n    \n    // ÏóÖÏ†Å Ï†ïÏùò\n    this.list = {\n      // Í∏∞Î≥∏\n      first_status: {\n        id: 'first_status',\n        name: 'ÏãúÏä§ÌÖú Ï†êÍ≤Ä',\n        desc: 'Ï≤òÏùåÏúºÎ°ú status Î™ÖÎ†πÏñ¥ ÏÇ¨Ïö©',\n        reward: 5,\n        unlocked: false,\n        hidden: false,\n      },\n      first_scan: {\n        id: 'first_scan',\n        name: 'Î†àÏù¥Îçî Í∞ÄÎèô',\n        desc: 'Ï≤òÏùåÏúºÎ°ú scan Î™ÖÎ†πÏñ¥ ÏÇ¨Ïö©',\n        reward: 5,\n        unlocked: false,\n        hidden: false,\n      },\n      first_move: {\n        id: 'first_move',\n        name: 'Ï≤´ Î∞úÍ±∏Ïùå',\n        desc: 'Ï≤òÏùåÏúºÎ°ú Îã§Î•∏ Î∞©ÏúºÎ°ú Ïù¥Îèô',\n        reward: 5,\n        unlocked: false,\n        hidden: false,\n      },\n      tutorial_complete: {\n        id: 'tutorial_complete',\n        name: 'ÌõàÎ†® ÏôÑÎ£å',\n        desc: 'ÌäúÌÜ†Î¶¨ÏñºÏùÑ ÏôÑÎ£å',\n        reward: 20,\n        unlocked: false,\n        hidden: false,\n      },\n      \n      // ÌÉàÏ∂ú\n      first_escape: {\n        id: 'first_escape',\n        name: 'ÏÉùÏ°¥Ïûê',\n        desc: 'Ï≤òÏùåÏúºÎ°ú ÌÉàÏ∂ú ÏÑ±Í≥µ',\n        reward: 50,\n        unlocked: false,\n        hidden: false,\n      },\n      speed_escape: {\n        id: 'speed_escape',\n        name: 'Ïä§ÌîºÎìúÎü¨ÎÑà',\n        desc: '5Î∂Ñ Ïù¥ÎÇ¥Ïóê ÌÉàÏ∂ú',\n        reward: 100,\n        unlocked: false,\n        hidden: false,\n      },\n      perfect_escape: {\n        id: 'perfect_escape',\n        name: 'ÏôÑÎ≤ΩÌïú ÌÉàÏ∂ú',\n        desc: 'Î™©Ìëú 3Í∞ú Î™®Îëê ÏôÑÎ£å ÌõÑ ÌÉàÏ∂ú',\n        reward: 80,\n        unlocked: false,\n        hidden: false,\n      },\n      low_o2_escape: {\n        id: 'low_o2_escape',\n        name: 'Ïà® Ï∞∏Í≥† ÌÉàÏ∂ú',\n        desc: 'O2 10% Ïù¥ÌïòÎ°ú ÌÉàÏ∂ú',\n        reward: 60,\n        unlocked: false,\n        hidden: false,\n      },\n      \n      // Í∂åÌïú\n      become_engineer: {\n        id: 'become_engineer',\n        name: 'ÏóîÏßÄÎãàÏñ¥',\n        desc: 'engineer Í∂åÌïú ÌöçÎìù',\n        reward: 10,\n        unlocked: false,\n        hidden: false,\n      },\n      become_admin: {\n        id: 'become_admin',\n        name: 'Í¥ÄÎ¶¨Ïûê',\n        desc: 'admin Í∂åÌïú ÌöçÎìù',\n        reward: 30,\n        unlocked: false,\n        hidden: false,\n      },\n      \n      // ÏÉùÏ°¥\n      danger_escape_1: {\n        id: 'danger_escape_1',\n        name: 'ÏïÑÏä¨ÏïÑÏä¨',\n        desc: 'Ï†Å Í±∞Î¶¨ 1ÏóêÏÑú ÏÉùÏ°¥',\n        reward: 15,\n        unlocked: false,\n        hidden: false,\n      },\n      danger_escape_5: {\n        id: 'danger_escape_5',\n        name: 'Îç∞Ïä§ ÎåÑÏÑú',\n        desc: 'Ï†Å Í±∞Î¶¨ 1ÏóêÏÑú 5Ìöå ÏÉùÏ°¥ (ÎàÑÏ†Å)',\n        reward: 50,\n        unlocked: false,\n        hidden: true,\n      },\n      hide_master: {\n        id: 'hide_master',\n        name: 'ÏùÄÏã†Ïùò Îã¨Ïù∏',\n        desc: 'hide Î™ÖÎ†πÏñ¥ 10Ìöå ÏÇ¨Ïö© (ÎàÑÏ†Å)',\n        reward: 30,\n        unlocked: false,\n        hidden: true,\n      },\n      \n      // ÏàòÎ¶¨\n      first_repair: {\n        id: 'first_repair',\n        name: 'ÏàòÎ¶¨Í≥µ',\n        desc: 'Ï≤òÏùåÏúºÎ°ú Î™©Ìëú ÏàòÎ¶¨ ÏôÑÎ£å',\n        reward: 15,\n        unlocked: false,\n        hidden: false,\n      },\n      repair_all: {\n        id: 'repair_all',\n        name: 'ÎßåÎä• Ï†ïÎπÑÏÇ¨',\n        desc: 'Ìïú Îü∞ÏóêÏÑú Î™©Ìëú 3Í∞ú Î™®Îëê ÏàòÎ¶¨',\n        reward: 40,\n        unlocked: false,\n        hidden: false,\n      },\n      \n      // Ïù¥Î≤§Ìä∏\n      survive_blackout: {\n        id: 'survive_blackout',\n        name: 'ÏïîÌùë ÏÜçÏóêÏÑú',\n        desc: 'Ï†ïÏ†Ñ Ïù¥Î≤§Ìä∏ Î∞úÏÉù ÌõÑ ÌÉàÏ∂ú',\n        reward: 20,\n        unlocked: false,\n        hidden: true,\n      },\n      survive_o2leak: {\n        id: 'survive_o2leak',\n        name: 'Ìò∏Ìù° Ï°∞Ï†à',\n        desc: 'ÏÇ∞ÏÜå ÎàÑÏ∂ú Ïù¥Î≤§Ìä∏ Î∞úÏÉù ÌõÑ ÌÉàÏ∂ú',\n        reward: 20,\n        unlocked: false,\n        hidden: true,\n      },\n      \n      // Î©îÌÉÄ\n      first_purchase: {\n        id: 'first_purchase',\n        name: 'ÏáºÌïë ÏãúÏûë',\n        desc: 'ÏÉÅÏ†êÏóêÏÑú Ï≤´ Íµ¨Îß§',\n        reward: 10,\n        unlocked: false,\n        hidden: false,\n      },\n      data_collector: {\n        id: 'data_collector',\n        name: 'Îç∞Ïù¥ÌÑ∞ ÏàòÏßëÍ∞Ä',\n        desc: 'Ï¥ù 500 DATA ÌöçÎìù',\n        reward: 100,\n        unlocked: false,\n        hidden: false,\n      },\n      \n      // Îü∞ ÌöüÏàò\n      runs_10: {\n        id: 'runs_10',\n        name: 'ÏßëÎÖê',\n        desc: '10Ìöå ÌîåÎ†àÏù¥',\n        reward: 30,\n        unlocked: false,\n        hidden: false,\n      },\n      runs_50: {\n        id: 'runs_50',\n        name: 'Î≤†ÌÖåÎûë',\n        desc: '50Ìöå ÌîåÎ†àÏù¥',\n        reward: 100,\n        unlocked: false,\n        hidden: true,\n      },\n      \n      // ÏÇ¨Îßù\n      first_death: {\n        id: 'first_death',\n        name: 'ÏãúÏûëÏù¥ Î∞ò',\n        desc: 'Ï≤òÏùåÏúºÎ°ú ÏÇ¨Îßù',\n        reward: 5,\n        unlocked: false,\n        hidden: false,\n      },\n      death_by_o2: {\n        id: 'death_by_o2',\n        name: 'ÏßàÏãù',\n        desc: 'ÏÇ∞ÏÜå Î∂ÄÏ°±ÏúºÎ°ú ÏÇ¨Îßù',\n        reward: 5,\n        unlocked: false,\n        hidden: true,\n      },\n      death_by_enemy: {\n        id: 'death_by_enemy',\n        name: 'Ï∂îÏ†ÅÎãπÌï®',\n        desc: 'Ï†ÅÏóêÍ≤å Î∞úÍ∞ÅÎêòÏñ¥ ÏÇ¨Îßù',\n        reward: 5,\n        unlocked: false,\n        hidden: true,\n      },\n    };\n    \n    // ÎàÑÏ†Å Ïπ¥Ïö¥ÌÑ∞ (ÏóÖÏ†Å Ï°∞Í±¥Ïö©)\n    this.counters = {\n      dangerEscapes: 0,\n      hideUsed: 0,\n      totalRuns: 0,\n      totalData: 0,\n    };\n    \n    // Ïù¥Î≤à Îü∞ ÌîåÎûòÍ∑∏\n    this.runFlags = {\n      hadBlackout: false,\n      hadO2Leak: false,\n    };\n    \n    this.load();\n  }\n  \n  load() {\n    try {\n      const raw = localStorage.getItem(STORAGE_KEY);\n      if (raw) {\n        const data = JSON.parse(raw);\n        if (data.unlocked) {\n          for (const id of data.unlocked) {\n            if (this.list[id]) {\n              this.list[id].unlocked = true;\n            }\n          }\n        }\n        if (data.counters) {\n          this.counters = { ...this.counters, ...data.counters };\n        }\n      }\n    } catch (e) {\n      console.warn('Achievements load failed:', e);\n    }\n  }\n  \n  save() {\n    try {\n      const unlocked = Object.values(this.list)\n        .filter(a => a.unlocked)\n        .map(a => a.id);\n      localStorage.setItem(STORAGE_KEY, JSON.stringify({\n        unlocked,\n        counters: this.counters,\n      }));\n    } catch (e) {\n      console.warn('Achievements save failed:', e);\n    }\n  }\n  \n  /**\n   * ÏóÖÏ†Å Ìï¥Í∏à\n   * - ÌÑ∞ÎØ∏ÎÑê Ï∂úÎ†• ‚ùå\n   * - Ïö∞Ï∏° ÌÜ†Ïä§Ìä∏/ÏÇ¨Ïù¥ÎìúÎ∞î ‚úÖ (AchievementsUIÎ°ú ÏúÑÏûÑ)\n   */\n  unlock(achievementId) {\n    const achievement = this.list[achievementId];\n    if (!achievement || achievement.unlocked) return 0;\n    \n    achievement.unlocked = true;\n    this.save();\n    \n    // METAÏóê DATA Ï∂îÍ∞Ä\n    if (this.game.meta) {\n      this.game.meta.saved.totalData += achievement.reward;\n      this.game.meta.save();\n    }\n    \n    // UI ÌÜ†Ïä§Ìä∏\n    if (this.game.achievementsUI) {\n      this.game.achievementsUI.onUnlock(achievement);\n    }\n    \n    return achievement.reward;\n  }\n  \n  check(eventType, data = {}) {\n    switch (eventType) {\n      case 'command':\n        this.checkCommand(data.cmd);\n        break;\n      case 'escape':\n        this.checkEscape(data);\n        break;\n      case 'death':\n        this.checkDeath(data);\n        break;\n      case 'permission':\n        this.checkPermission(data.level);\n        break;\n      case 'repair':\n        this.checkRepair(data);\n        break;\n      case 'event':\n        this.checkEvent(data.type);\n        break;\n      case 'purchase':\n        this.unlock('first_purchase');\n        break;\n      case 'tutorial_complete':\n        this.unlock('tutorial_complete');\n        break;\n      case 'danger_escape':\n        this.counters.dangerEscapes++;\n        this.save();\n        this.unlock('danger_escape_1');\n        if (this.counters.dangerEscapes >= 5) {\n          this.unlock('danger_escape_5');\n        }\n        break;\n    }\n  }\n  \n  checkCommand(cmd) {\n    if (cmd === 'status') this.unlock('first_status');\n    if (cmd === 'scan') this.unlock('first_scan');\n    if (cmd.startsWith('cd ')) this.unlock('first_move');\n    if (cmd === 'hide') {\n      this.counters.hideUsed++;\n      this.save();\n      if (this.counters.hideUsed >= 10) {\n        this.unlock('hide_master');\n      }\n    }\n  }\n  \n  checkEscape(data) {\n    this.unlock('first_escape');\n    if (data.time <= 300) this.unlock('speed_escape');\n    if (data.objectives >= 3) this.unlock('perfect_escape');\n    if (data.o2 <= 10) this.unlock('low_o2_escape');\n    if (this.runFlags.hadBlackout) this.unlock('survive_blackout');\n    if (this.runFlags.hadO2Leak) this.unlock('survive_o2leak');\n  }\n  \n  checkDeath(data) {\n    this.unlock('first_death');\n    if (data.cause === 'o2') this.unlock('death_by_o2');\n    else if (data.cause === 'enemy') this.unlock('death_by_enemy');\n  }\n  \n  checkPermission(level) {\n    if (level === 'engineer') this.unlock('become_engineer');\n    if (level === 'admin') this.unlock('become_admin');\n  }\n  \n  checkRepair(data) {\n    this.unlock('first_repair');\n    if (data.total >= 3) this.unlock('repair_all');\n  }\n  \n  checkEvent(type) {\n    if (type === 'blackout') this.runFlags.hadBlackout = true;\n    if (type === 'o2leak') this.runFlags.hadO2Leak = true;\n  }\n  \n  resetRunFlags() {\n    this.runFlags = { hadBlackout: false, hadO2Leak: false };\n  }\n  \n  checkRuns(totalRuns) {\n    this.counters.totalRuns = totalRuns;\n    this.save();\n    if (totalRuns >= 10) this.unlock('runs_10');\n    if (totalRuns >= 50) this.unlock('runs_50');\n  }\n  \n  checkTotalData(total) {\n    this.counters.totalData = total;\n    this.save();\n    if (total >= 500) this.unlock('data_collector');\n  }\n  \n  showList() {\n    this.game.print('');\n    this.game.print('=== ÏóÖÏ†Å ===', 'system');\n    const unlocked = Object.values(this.list).filter(a => a.unlocked);\n    const locked = Object.values(this.list).filter(a => !a.unlocked && !a.hidden);\n    const hidden = Object.values(this.list).filter(a => !a.unlocked && a.hidden);\n    this.game.print(`Îã¨ÏÑ±: ${unlocked.length}/${Object.keys(this.list).length}`, 'system');\n    this.game.print('');\n    if (unlocked.length > 0) {\n      this.game.print('[Îã¨ÏÑ±Ìïú ÏóÖÏ†Å]', 'success');\n      unlocked.forEach(a => this.game.print(`  üèÜ ${a.name} - ${a.desc}`));\n      this.game.print('');\n    }\n    if (locked.length > 0) {\n      this.game.print('[ÎØ∏Îã¨ÏÑ± ÏóÖÏ†Å]', 'warning');\n      locked.forEach(a => this.game.print(`  ‚óã ${a.name} - ${a.desc} (+${a.reward} DATA)`));\n      this.game.print('');\n    }\n    if (hidden.length > 0) {\n      this.game.print(`[Ïà®Í≤®ÏßÑ ÏóÖÏ†Å: ${hidden.length}Í∞ú]`, 'system');\n    }\n    this.game.print('');\n  }\n  \n  reset() {\n    localStorage.removeItem(STORAGE_KEY);\n    for (const a of Object.values(this.list)) {\n      a.unlocked = false;\n    }\n    this.counters = { dangerEscapes: 0, hideUsed: 0, totalRuns: 0, totalData: 0 };\n  }\n}\n